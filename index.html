<!doctype html>

<html lang="zh">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>中国旅游推荐（从延吉出发） — 城市 + 景区版 v3</title>
  <style>
    :root { --bg:#fafbff; --card:#ffffff; --ink:#0f172a; --muted:#64748b; --line:#e5e7eb; --accent:#2563eb; }
    *{ box-sizing:border-box }
    body{ margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, Noto Sans, "Apple Color Emoji","Segoe UI Emoji"; background:var(--bg); color:var(--ink); }
    .wrap{ max-width:1000px; margin:0 auto; padding:24px; }
    header{ display:flex; flex-wrap:wrap; align-items:flex-end; justify-content:space-between; gap:12px; }
    h1{ margin:0; font-size:clamp(22px, 3vw, 28px); }
    p.lead{ color:var(--muted); margin:6px 0 0; }
    .card{ background:var(--card); border:1px solid var(--line); border-radius:16px; padding:16px; box-shadow:0 1px 2px rgba(0,0,0,.04); }
    .row{ display:flex; flex-wrap:wrap; gap:8px; align-items:center; }
    .row > *{ margin:4px 0; }
    button{ appearance:none; border:1px solid var(--line); background:#fff; color:var(--ink); padding:10px 14px; border-radius:12px; cursor:pointer; font-weight:600; }
    button.primary{ background:var(--accent); color:#fff; border-color:var(--accent); }
    button.ghost{ background:transparent; }
    button:disabled{ opacity:.6; cursor:not-allowed; }
    input{ width:100%; max-width:360px; padding:10px 12px; border:1px solid var(--line); border-radius:10px; }
    .grid{ display:grid; grid-template-columns:repeat(auto-fill, minmax(260px,1fr)); gap:12px; }
    .fav{ border:1px dashed var(--line); border-radius:12px; padding:12px; }
    .meta{ color:var(--muted); font-size:14px; }
    .kvs{ margin:8px 0 0; display:grid; grid-template-columns: 140px 1fr; gap:6px 10px; font-size:14px; }
    .kvs div{ padding:2px 0; }
    .kvs .key{ color:var(--muted); }
    .title{ font-weight:700; font-size:18px; }
    .badge{ display:inline-block; margin-left:8px; padding:2px 8px; border-radius:999px; background:#eef2ff; color:#3730a3; font-size:12px; }
    .spacer{ height:8px; }
    footer{ color:var(--muted); font-size:13px; margin-top:18px; }
    details.spots summary{ cursor:pointer; color:var(--accent); }
    .spot-list{ display:grid; gap:8px; margin-top:8px; }
    .spot-item{ border:1px solid var(--line); border-radius:10px; padding:10px; background:#fff; }
    .spot-item .name{ font-weight:700; }
    .spot-item .sub{ color:#334155; font-size:13px; margin-top:4px; }
    .spot-item a{ font-size:12px; color:var(--accent); text-decoration:none; }
    .spot-item a:hover{ text-decoration:underline; }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>中国旅游推荐（从延吉出发）</h1>
        <p class="lead">v3：将“热门景区（如黄山、泰山、丽江等）”纳入推荐；保留收藏/导出与景点百科简介。*数据为近似示意*</p>
      </div>
      <div class="row">
        <button id="btn-roll" class="primary">再推荐</button>
        <button id="btn-fav">收藏</button>
        <button id="btn-export" class="ghost">导出收藏</button>
      </div>
    </header>

```
<div class="spacer"></div>

<!-- 城市/景区筛选 + 快速选择 -->
<div class="row card" style="gap:10px; align-items:center;">
  <select id="filter-type">
    <option value="all">全部</option>
    <option value="city">仅城市</option>
    <option value="scenic">仅景区</option>
  </select>
  <input id="picker" list="name-list" placeholder="快速查找（如：北京、黄山、丽江）" style="flex:1; max-width:520px;" />
  <datalist id="name-list"></datalist>
  <button id="btn-pick" class="primary">选择</button>
  <button id="btn-clear" class="ghost">清空</button>
</div>

<div class="spacer"></div>

<section id="current" class="card" aria-live="polite"></section>

<div class="spacer"></div>

<div class="row">
  <input id="search" placeholder="搜索收藏 (例: 北京、黄山、丽江)" />
</div>

<h3>收藏</h3>
<section id="favorites" class="grid" aria-live="polite"></section>

<footer>提示：人口多参考七普或近似；景点评级为示意；收藏仅保存在浏览器本地。</footer>
```

  </div>

<script>
/********************
 *  数据层
 ********************/
// —— 1) 你的原 50 城（略） ——
const CITIES = [
  { type:'city', name: "北京", distance: "约 1,500 公里 / 飞行 2 小时", gdp: "人均GDP：约 ¥180,000", spot: "故宫、长城", temp: "10月：12℃", food: "北京烤鸭", population: "约 2,200 万", province: "直辖市·北京", location: "华北地区" },
  { type:'city', name: "上海", distance: "约 1,800 公里 / 飞行 2.5 小时", gdp: "人均GDP：约 ¥190,000", spot: "外滩、东方明珠", temp: "10月：19℃", food: "生煎、小笼包", population: "约 2,500 万", province: "直辖市·上海", location: "华东沿海" },
  { type:'city', name: "广州", distance: "约 2,800 公里 / 飞行 3.5 小时", gdp: "人均GDP：约 ¥170,000", spot: "广州塔、沙面", temp: "10月：26℃", food: "早茶、烧鹅", population: "约 1,900 万", province: "广东省", location: "华南沿海" },
  { type:'city', name: "深圳", distance: "约 2,900 公里 / 飞行 3.5 小时", gdp: "人均GDP：约 ¥220,000", spot: "深圳湾、公园群", temp: "10月：26℃", food: "海鲜、客家菜", population: "约 1,750 万", province: "广东省", location: "珠三角" },
  { type:'city', name: "杭州", distance: "约 1,900 公里 / 飞行 2.5 小时", gdp: "人均GDP：约 ¥180,000", spot: "西湖、灵隐寺", temp: "10月：19℃", food: "西湖醋鱼、东坡肉", population: "约 1,220 万", province: "浙江省", location: "华东沿海" },
  { type:'city', name: "成都", distance: "约 2,800 公里 / 飞行 3.5 小时", gdp: "人均GDP：约 ¥120,000", spot: "大熊猫基地、锦里", temp: "10月：18℃", food: "火锅、串串", population: "约 2,100 万", province: "四川省", location: "西南地区" },
  { type:'city', name: "重庆", distance: "约 2,700 公里 / 飞行 3.5 小时", gdp: "人均GDP：约 ¥100,000", spot: "洪崖洞、解放碑", temp: "10月：20℃", food: "重庆火锅、小面", population: "约 3,100 万", province: "直辖市·重庆", location: "西南地区" },
  { type:'city', name: "武汉", distance: "约 2,200 公里 / 飞行 3 小时", gdp: "人均GDP：约 ¥130,000", spot: "黄鹤楼、东湖", temp: "10月：20℃", food: "热干面、鸭脖", population: "约 1,300 万", province: "湖北省", location: "华中地区" },
  { type:'city', name: "西安", distance: "约 2,200 公里 / 飞行 3 小时", gdp: "人均GDP：约 ¥110,000", spot: "兵马俑、古城墙", temp: "10月：14℃", food: "肉夹馍、凉皮", population: "约 1,300 万", province: "陕西省", location: "西北地区" },
  { type:'city', name: "苏州", distance: "约 1,900 公里 / 飞行 2.5 小时", gdp: "人均GDP：约 ¥200,000", spot: "拙政园、周庄", temp: "10月：19℃", food: "苏式面、松鼠桂鱼", population: "约 1,300 万", province: "江苏省", location: "长三角" },
  { type:'city', name: "南京", distance: "约 1,950 公里 / 飞行 2.5 小时", gdp: "人均GDP：约 ¥170,000", spot: "中山陵、夫子庙", temp: "10月：19℃", food: "盐水鸭、鸭血粉丝汤", population: "约 950 万", province: "江苏省", location: "华东地区" },
  { type:'city', name: "天津", distance: "约 1,600 公里 / 飞行 2 小时", gdp: "人均GDP：约 ¥120,000", spot: "意式风情区、海河", temp: "10月：14℃", food: "煎饼果子、耳朵眼炸糕", population: "约 1,380 万", province: "直辖市·天津", location: "环渤海" },
  { type:'city', name: "郑州", distance: "约 2,000 公里 / 飞行 3 小时", gdp: "人均GDP：约 ¥110,000", spot: "少林寺(登封)", temp: "10月：17℃", food: "胡辣汤", population: "约 1,300 万", province: "河南省", location: "华中地区" },
  { type:'city', name: "长沙", distance: "约 2,300 公里 / 飞行 3 小时", gdp: "人均GDP：约 ¥120,000", spot: "岳麓山、橘子洲", temp: "10月：21℃", food: "口味虾、剁椒鱼头", population: "约 1,000 万", province: "湖南省", location: "华中地区" },
  { type:'city', name: "宁波", distance: "约 1,950 公里 / 飞行 2.5 小时", gdp: "人均GDP：约 ¥190,000", spot: "天一阁、老外滩", temp: "10月：20℃", food: "海鲜、汤圆", population: "约 950 万", province: "浙江省", location: "华东沿海" },
  { type:'city', name: "厦门", distance: "约 2,300 公里 / 飞行 3 小时", gdp: "人均GDP：约 ¥180,000", spot: "鼓浪屿", temp: "10月：25℃", food: "沙茶面、花生汤", population: "约 500 万", province: "福建省", location: "东南沿海" },
  { type:'city', name: "福州", distance: "约 2,200 公里 / 飞行 3 小时", gdp: "人均GDP：约 ¥150,000", spot: "三坊七巷", temp: "10月：23℃", food: "佛跳墙、鱼丸", population: "约 800 万", province: "福建省", location: "东南沿海" },
  { type:'city', name: "哈尔滨", distance: "约 500 公里 / 飞行 1 小时", gdp: "人均GDP：约 ¥90,000", spot: "冰雪大世界", temp: "10月：6℃", food: "红肠、锅包肉", population: "约 950 万", province: "黑龙江省", location: "东北地区" },
  { type:'city', name: "沈阳", distance: "约 400 公里 / 飞行 1 小时", gdp: "人均GDP：约 ¥100,000", spot: "故宫(沈阳)", temp: "10月：10℃", food: "老四样、鸡架", population: "约 920 万", province: "辽宁省", location: "东北地区" },
  { type:'city', name: "大连", distance: "约 650 公里 / 飞行 1.5 小时", gdp: "人均GDP：约 ¥130,000", spot: "星海广场、滨海路", temp: "10月：14℃", food: "海鲜、焖子", population: "约 750 万", province: "辽宁省", location: "渤海沿海" },
  { type:'city', name: "青岛", distance: "约 1,200 公里 / 飞行 2 小时", gdp: "人均GDP：约 ¥150,000", spot: "栈桥、崂山", temp: "10月：17℃", food: "啤酒、海鲜", population: "约 1,000 万", province: "山东省", location: "华东沿海" },
  { type:'city', name: "济南", distance: "约 1,400 公里 / 飞行 2 小时", gdp: "人均GDP：约 ¥130,000", spot: "趵突泉、千佛山", temp: "10月：16℃", food: "把子肉、甜沫", population: "约 920 万", province: "山东省", location: "华东地区" },
  { type:'city', name: "合肥", distance: "约 1,800 公里 / 飞行 2.5 小时", gdp: "人均GDP：约 ¥120,000", spot: "三河古镇", temp: "10月：18℃", food: "庐州烤鸭、鸭油烧饼", population: "约 960 万", province: "安徽省", location: "华东地区" },
  { type:'city', name: "昆明", distance: "约 3,100 公里 / 飞行 4 小时", gdp: "人均GDP：约 ¥100,000", spot: "滇池、石林", temp: "10月：16℃", food: "过桥米线", population: "约 850 万", province: "云南省", location: "西南高原" },
  { type:'city', name: "贵阳", distance: "约 2,900 公里 / 飞行 3.5 小时", gdp: "人均GDP：约 ¥95,000", spot: "甲秀楼、青岩古镇", temp: "10月：16℃", food: "酸汤鱼", population: "约 600 万", province: "贵州省", location: "西南地区" },
  { type:'city', name: "南宁", distance: "约 3,200 公里 / 飞行 4 小时", gdp: "人均GDP：约 ¥95,000", spot: "南湖公园、青秀山", temp: "10月：25℃", food: "老友粉", population: "约 880 万", province: "广西壮族自治区", location: "华南边疆" },
  { type:'city', name: "无锡", distance: "约 1,950 公里 / 飞行 2.5 小时", gdp: "人均GDP：约 ¥200,000", spot: "太湖、灵山大佛", temp: "10月：19℃", food: "酱排骨、小笼包", population: "约 750 万", province: "江苏省", location: "长三角" },
  { type:'city', name: "长春", distance: "约 300 公里 / 飞行 1 小时", gdp: "人均GDP：约 ¥90,000", spot: "净月潭", temp: "10月：8℃", food: "锅包肉、酱骨头", population: "约 900 万", province: "吉林省", location: "东北地区" },
  { type:'city', name: "石家庄", distance: "约 1,800 公里 / 飞行 2.5 小时", gdp: "人均GDP：约 ¥100,000", spot: "赵州桥、抱犊寨", temp: "10月：14℃", food: "驴肉火烧", population: "约 1,100 万", province: "河北省", location: "华北地区" },
  { type:'city', name: "太原", distance: "约 2,000 公里 / 飞行 3 小时", gdp: "人均GDP：约 ¥100,000", spot: "晋祠、双塔寺", temp: "10月：12℃", food: "刀削面", population: "约 550 万", province: "山西省", location: "华北地区" },
  { type:'city', name: "兰州", distance: "约 2,600 公里 / 飞行 3.5 小时", gdp: "人均GDP：约 ¥95,000", spot: "黄河铁桥、五泉山", temp: "10月：10℃", food: "兰州拉面", population: "约 440 万", province: "甘肃省", location: "西北地区" },
  { type:'city', name: "银川", distance: "约 2,600 公里 / 飞行 3.5 小时", gdp: "人均GDP：约 ¥100,000", spot: "沙湖、西夏王陵", temp: "10月：11℃", food: "手抓羊肉", population: "约 280 万", province: "宁夏回族自治区", location: "西北地区" },
  { type:'city', name: "西宁", distance: "约 2,900 公里 / 飞行 4 小时", gdp: "人均GDP：约 ¥95,000", spot: "青海湖、塔尔寺", temp: "10月：7℃", food: "牦牛肉", population: "约 240 万", province: "青海省", location: "青藏高原东部" },
  { type:'city', name: "呼和浩特", distance: "约 2,100 公里 / 飞行 3 小时", gdp: "人均GDP：约 ¥100,000", spot: "大召寺、昭君博物院", temp: "10月：9℃", food: "手把肉、奶茶", population: "约 350 万", province: "内蒙古自治区", location: "华北边缘" },
  { type:'city', name: "保定", distance: "约 1,700 公里 / 飞行 2.5 小时", gdp: "人均GDP：约 ¥90,000", spot: "古莲花池", temp: "10月：13℃", food: "驴肉火烧", population: "约 1,100 万", province: "河北省", location: "京津冀" },
  { type:'city', name: "扬州", distance: "约 2,000 公里 / 飞行 3 小时", gdp: "人均GDP：约 ¥120,000", spot: "瘦西湖", temp: "10月：18℃", food: "扬州炒饭、早茶", population: "约 460 万", province: "江苏省", location: "长江下游" },
  { type:'city', name: "常州", distance: "约 1,980 公里 / 飞行 2.5 小时", gdp: "人均GDP：约 ¥160,000", spot: "中华恐龙园", temp: "10月：18℃", food: "麻糕、阳湖鹅", population: "约 540 万", province: "江苏省", location: "长三角" },
  { type:'city', name: "南通", distance: "约 2,000 公里 / 飞行 3 小时", gdp: "人均GDP：约 ¥150,000", spot: "狼山、濠河", temp: "10月：18℃", food: "文蛤、江鲜", population: "约 730 万", province: "江苏省", location: "长江入海口北翼" },
  { type:'city', name: "威海", distance: "约 1,100 公里 / 飞行 2 小时", gdp: "人均GDP：约 ¥140,000", spot: "刘公岛", temp: "10月：16℃", food: "海参、海带", population: "约 280 万", province: "山东省", location: "胶东半岛东端" },
  { type:'city', name: "烟台", distance: "约 1,100 公里 / 飞行 2 小时", gdp: "人均GDP：约 ¥140,000", spot: "蓬莱阁、长岛", temp: "10月：16℃", food: "海鲜、苹果制品", population: "约 700 万", province: "山东省", location: "胶东半岛" },
  { type:'city', name: "嘉兴", distance: "约 1,950 公里 / 飞行 2.5 小时", gdp: "人均GDP：约 ¥170,000", spot: "乌镇", temp: "10月：19℃", food: "粽子、酱鸭", population: "约 560 万", province: "浙江省", location: "杭嘉湖平原" },
  { type:'city', name: "温州", distance: "约 2,050 公里 / 飞行 3 小时", gdp: "人均GDP：约 ¥130,000", spot: "雁荡山、楠溪江", temp: "10月：22℃", food: "鱼丸、海鲜", population: "约 950 万", province: "浙江省", location: "东南沿海" },
  { type:'city', name: "惠州", distance: "约 2,850 公里 / 飞行 3.5 小时", gdp: "人均GDP：约 ¥120,000", spot: "西湖、双月湾", temp: "10月：26℃", food: "客家酿豆腐", population: "约 600 万", province: "广东省", location: "珠三角东部" },
  { type:'city', name: "东莞", distance: "约 2,850 公里 / 飞行 3.5 小时", gdp: "人均GDP：约 ¥180,000", spot: "虎门大桥、松山湖", temp: "10月：26℃", food: "肠粉、烧鹅", population: "约 1,000 万", province: "广东省", location: "珠三角" },
  { type:'city', name: "佛山", distance: "约 2,800 公里 / 飞行 3.5 小时", gdp: "人均GDP：约 ¥160,000", spot: "祖庙、顺德水乡", temp: "10月：26℃", food: "双皮奶、顺德菜", population: "约 950 万", province: "广东省", location: "珠三角" },
  { type:'city', name: "珠海", distance: "约 2,950 公里 / 飞行 3.5 小时", gdp: "人均GDP：约 ¥200,000", spot: "日月贝、情侣路", temp: "10月：26℃", food: "海鲜、葡式蛋挞", population: "约 250 万", province: "广东省", location: "珠江西岸" },
  { type:'city', name: "乌鲁木齐", distance: "约 4,700 公里 / 飞行 5.5 小时", gdp: "人均GDP：约 ¥120,000", spot: "天山天池", temp: "10月：7℃", food: "抓饭、烤肉", population: "约 400 万", province: "新疆维吾尔自治区", location: "欧亚内陆中心" },
  { type:'city', name: "三亚", distance: "约 4,600 公里 / 飞行 5.5 小时", gdp: "人均GDP：约 ¥120,000", spot: "亚龙湾、天涯海角", temp: "10月：27℃", food: "海鲜、清补凉", population: "约 120 万", province: "海南省", location: "南端海滨" },
  { type:'city', name: "海口", distance: "约 4,400 公里 / 飞行 5 小时", gdp: "人均GDP：约 ¥110,000", spot: "骑楼老街", temp: "10月：27℃", food: "椰子鸡、清补凉", population: "约 280 万", province: "海南省", location: "北部海滨" },
  { type:'city', name: "桂林", distance: "约 3,200 公里 / 飞行 4 小时", gdp: "人均GDP：约 ¥90,000", spot: "漓江、阳朔", temp: "10月：22℃", food: "米粉、田螺", population: "约 500 万", province: "广西壮族自治区", location: "华南喀斯特" },
  { type:'city', name: "张家界", distance: "约 3,000 公里 / 飞行 4 小时", gdp: "人均GDP：约 ¥85,000", spot: "武陵源景区", temp: "10月：18℃", food: "三下锅", population: "约 160 万", province: "湖南省", location: "武陵山脉" },
  { type:'city', name: "洛阳", distance: "约 2,100 公里 / 飞行 3 小时", gdp: "人均GDP：约 ¥100,000", spot: "龙门石窟", temp: "10月：16℃", food: "水席", population: "约 700 万", province: "河南省", location: "中原西部" },
  { type:'city', name: "开封", distance: "约 2,000 公里 / 飞行 3 小时", gdp: "人均GDP：约 ¥90,000", spot: "清明上河园", temp: "10月：16℃", food: "灌汤包", population: "约 500 万", province: "河南省", location: "中原东部" },
  { type:'city', name: "南昌", distance: "约 2,200 公里 / 飞行 3 小时", gdp: "人均GDP：约 ¥110,000", spot: "滕王阁", temp: "10月：20℃", food: "拌粉、瓦罐汤", population: "约 650 万", province: "江西省", location: "华中南部" },
  { type:'city', name: "合川(重庆)", distance: "约 2,700 公里 / 飞行 3.5 小时", gdp: "人均GDP：约 ¥95,000", spot: "钓鱼城遗址", temp: "10月：19℃", food: "江湖菜", population: "约 150 万", province: "重庆市", location: "嘉陵江沿岸" },
  { type:'city', name: "秦皇岛", distance: "约 1,500 公里 / 飞行 2 小时", gdp: "人均GDP：约 ¥100,000", spot: "老龙头、北戴河", temp: "10月：14℃", food: "海鲜", population: "约 300 万", province: "河北省", location: "渤海湾" },
  { type:'city', name: "绍兴", distance: "约 2,000 公里 / 飞行 3 小时", gdp: "人均GDP：约 ¥170,000", spot: "鲁迅故里、东湖", temp: "10月：19℃", food: "黄酒、臭豆腐", population: "约 500 万", province: "浙江省", location: "浙东平原" },
  { type:'city', name: "舟山", distance: "约 2,100 公里 / 飞行 3 小时", gdp: "人均GDP：约 ¥160,000", spot: "普陀山", temp: "10月：20℃", food: "海鲜", population: "约 110 万", province: "浙江省", location: "东海群岛" },
  { type:'city', name: "肇庆", distance: "约 2,700 公里 / 飞行 3.5 小时", gdp: "人均GDP：约 ¥110,000", spot: "七星岩", temp: "10月：26℃", food: "裹蒸粽", population: "约 400 万", province: "广东省", location: "珠江西江上游" },
  { type:'city', name: "中山", distance: "约 2,900 公里 / 飞行 3.5 小时", gdp: "人均GDP：约 ¥150,000", spot: "孙中山故里", temp: "10月：26℃", food: "石岐乳鸽", population: "约 440 万", province: "广东省", location: "珠江西岸" },
  { type:'city', name: "鞍山", distance: "约 500 公里 / 飞行 1 小时", gdp: "人均GDP：约 ¥95,000", spot: "千山", temp: "10月：11℃", food: "海城馅饼", population: "约 330 万", province: "辽宁省", location: "辽东半岛北部" },
  { type:'city', name: "齐齐哈尔", distance: "约 700 公里 / 飞行 1.5 小时", gdp: "人均GDP：约 ¥80,000", spot: "扎龙自然保护区", temp: "10月：5℃", food: "烤肉、酸菜", population: "约 520 万", province: "黑龙江省", location: "松嫩平原" },
  { type:'city', name: "大庆", distance: "约 650 公里 / 飞行 1.5 小时", gdp: "人均GDP：约 ¥130,000", spot: "油田科普园", temp: "10月：7℃", food: "东北菜", population: "约 280 万", province: "黑龙江省", location: "松嫩平原" }
];

// —— 2) 新增：热门景区清单（示意数据；可逐步完善） ——
const SCENIC = [
  { type:'scenic', name:'黄山', province:'安徽省', nearCity:'黄山市(屯溪/汤口)', level:'5A(示意)', distance:'约 2,400 公里 / 飞行 4 小时', bestSeason:'春秋观云海，冬季雾凇', hotelBudget:'¥300-600/晚（山下）', stayArea:'汤口镇/屯溪老街', spot:'迎客松、西海大峡谷、光明顶' },
  { type:'scenic', name:'泰山', province:'山东省', nearCity:'泰安市/济南', level:'5A(示意)', distance:'约 1,800 公里 / 飞行 2.5 小时', bestSeason:'4-10月', hotelBudget:'¥200-400/晚', stayArea:'泰安红门/天外村', spot:'南天门、岱庙、十八盘' },
  { type:'scenic', name:'丽江古城', province:'云南省', nearCity:'丽江市', level:'5A(示意)', distance:'约 3,400 公里 / 飞行 4.5 小时', bestSeason:'9-11月气候舒适', hotelBudget:'¥200-500/晚', stayArea:'大研古城/束河', spot:'四方街、木府、黑龙潭' },
  { type:'scenic', name:'大理', province:'云南省', nearCity:'大理市', level:'5A(示意)', distance:'约 3,200 公里 / 飞行 4.5 小时', bestSeason:'3-5月、9-11月', hotelBudget:'¥200-500/晚', stayArea:'大理古城/双廊/才村', spot:'洱海、崇圣寺三塔、喜洲古镇' },
  { type:'scenic', name:'云冈石窟', province:'山西省', nearCity:'大同市', level:'5A(示意)', distance:'约 1,600 公里 / 飞行 2.5 小时', bestSeason:'4-10月', hotelBudget:'¥180-350/晚', stayArea:'大同古城', spot:'第20窟、昙曜五窟、灵岩寺' },
  { type:'scenic', name:'悬空寺/恒山', province:'山西省', nearCity:'大同市', level:'4A-5A(示意)', distance:'约 1,650 公里 / 飞行 2.5 小时', bestSeason:'4-10月', hotelBudget:'¥180-350/晚', stayArea:'浑源县/大同', spot:'恒山主峰、悬空寺、北岳庙' },
  { type:'scenic', name:'九寨沟', province:'四川省', nearCity:'阿坝州(九寨沟县)', level:'5A(示意)', distance:'约 3,300 公里 / 飞行 5 小时', bestSeason:'9-11月彩林季', hotelBudget:'¥300-700/晚', stayArea:'沟口漳扎镇', spot:'五花海、镜海、诺日朗瀑布' },
  { type:'scenic', name:'黄龙', province:'四川省', nearCity:'松潘县', level:'5A(示意)', distance:'约 3,250 公里 / 飞行 5 小时', bestSeason:'9-10月', hotelBudget:'¥250-500/晚', stayArea:'川主寺', spot:'五彩池、雪山彩池群' },
  { type:'scenic', name:'稻城亚丁', province:'四川省', nearCity:'甘孜州(稻城县)', level:'5A(示意)', distance:'约 4,000 公里 / 飞行 6 小时', bestSeason:'9-10月', hotelBudget:'¥300-600/晚', stayArea:'香格里拉镇', spot:'仙乃日、央迈勇、夏诺多吉' },
  { type:'scenic', name:'峨眉山 & 乐山大佛', province:'四川省', nearCity:'乐山市/峨眉山市', level:'5A(示意)', distance:'约 3,000 公里 / 飞行 4.5 小时', bestSeason:'春秋最佳', hotelBudget:'¥200-500/晚', stayArea:'报国寺/乐山城区', spot:'金顶、报国寺、凌云寺' },
  { type:'scenic', name:'武当山', province:'湖北省', nearCity:'十堰市', level:'5A(示意)', distance:'约 2,400 公里 / 飞行 4 小时', bestSeason:'4-10月', hotelBudget:'¥200-400/晚', stayArea:'太子坡/山门口', spot:'金顶、紫霄宫、南岩宫' },
  { type:'scenic', name:'武夷山', province:'福建省', nearCity:'南平市(武夷山市)', level:'5A(示意)', distance:'约 2,500 公里 / 飞行 4 小时', bestSeason:'4-11月', hotelBudget:'¥200-400/晚', stayArea:'度假区北入口', spot:'天游峰、九曲溪、玉女峰' },
  { type:'scenic', name:'庐山', province:'江西省', nearCity:'九江市', level:'5A(示意)', distance:'约 2,300 公里 / 飞行 4 小时', bestSeason:'6-10月', hotelBudget:'¥200-400/晚', stayArea:'牯岭镇', spot:'含鄱口、三叠泉、如琴湖' },
  { type:'scenic', name:'婺源', province:'江西省', nearCity:'上饶市', level:'5A(示意)', distance:'约 2,000 公里 / 飞行 3.5 小时', bestSeason:'3-4月油菜花、11月秋色', hotelBudget:'¥150-350/晚', stayArea:'篁岭/江湾/思溪延村', spot:'篁岭梯田、江岭、月亮湾' },
  { type:'scenic', name:'平遥古城', province:'山西省', nearCity:'晋中市(平遥县)', level:'5A(示意)', distance:'约 2,000 公里 / 飞行 3 小时', bestSeason:'4-10月', hotelBudget:'¥150-300/晚', stayArea:'古城内客栈区', spot:'日升昌票号、城墙、文庙' },
  { type:'scenic', name:'凤凰古城', province:'湖南省', nearCity:'湘西州(凤凰县)', level:'4A-5A(示意)', distance:'约 3,000 公里 / 飞行 4.5 小时', bestSeason:'4-10月', hotelBudget:'¥150-300/晚', stayArea:'沱江两岸', spot:'虹桥、沱江泛舟、南华山' },
  { type:'scenic', name:'恩施大峡谷', province:'湖北省', nearCity:'恩施市', level:'5A(示意)', distance:'约 2,800 公里 / 飞行 4.5 小时', bestSeason:'4-10月', hotelBudget:'¥180-350/晚', stayArea:'沐抚镇', spot:'云龙地缝、一炷香、七星寨' },
  { type:'scenic', name:'云台山', province:'河南省', nearCity:'焦作市', level:'5A(示意)', distance:'约 2,000 公里 / 飞行 3 小时', bestSeason:'4-10月', hotelBudget:'¥150-300/晚', stayArea:'岸上服务区', spot:'红石峡、潭瀑峡、子房湖' },
  { type:'scenic', name:'张掖丹霞', province:'甘肃省', nearCity:'张掖市', level:'5A(示意)', distance:'约 3,200 公里 / 飞行 4.5 小时', bestSeason:'6-9月晴天傍晚', hotelBudget:'¥150-300/晚', stayArea:'临泽倪家营', spot:'七彩丹霞景区、冰沟丹霞' },
  { type:'scenic', name:'敦煌莫高窟', province:'甘肃省', nearCity:'敦煌市', level:'5A(示意)', distance:'约 3,800 公里 / 飞行 5.5 小时', bestSeason:'5-10月', hotelBudget:'¥200-400/晚', stayArea:'敦煌市区', spot:'莫高窟、鸣沙山月牙泉' },
  { type:'scenic', name:'呼伦贝尔大草原', province:'内蒙古自治区', nearCity:'海拉尔/满洲里', level:'5A(示意)', distance:'约 1,200 公里 / 飞行 2 小时', bestSeason:'6-9月', hotelBudget:'¥200-400/晚', stayArea:'海拉尔/额尔古纳', spot:'额尔古纳湿地、根河、白桦林' },
  { type:'scenic', name:'千岛湖', province:'浙江省', nearCity:'淳安县(杭州辖)', level:'5A(示意)', distance:'约 2,000 公里 / 飞行 3 小时', bestSeason:'4-11月', hotelBudget:'¥200-500/晚', stayArea:'千岛湖镇', spot:'梅峰岛、龙山岛、湖上骑行' },
  { type:'scenic', name:'西塘古镇', province:'浙江省', nearCity:'嘉善县', level:'4A(示意)', distance:'约 1,950 公里 / 飞行 2.5 小时', bestSeason:'3-11月', hotelBudget:'¥150-300/晚', stayArea:'古镇内', spot:'烟雨长廊、石皮弄、送子来风桥' },
  { type:'scenic', name:'龙脊梯田', province:'广西壮族自治区', nearCity:'桂林市(龙胜县)', level:'5A(示意)', distance:'约 3,200 公里 / 飞行 4 小时', bestSeason:'5-6月灌水、9-10月金黄', hotelBudget:'¥150-300/晚', stayArea:'平安/大寨村', spot:'金佛顶、七星伴月、千层天梯' },
  { type:'scenic', name:'漠河北极村', province:'黑龙江省', nearCity:'漠河市', level:'4A(示意)', distance:'约 1,100 公里 / 飞行 2 小时', bestSeason:'12-2月极夜冰雪、5-8月避暑', hotelBudget:'¥200-400/晚', stayArea:'北极村/西林吉', spot:'最北邮局、神州北极广场' },
  { type:'scenic', name:'西双版纳', province:'云南省', nearCity:'景洪市', level:'5A(示意)', distance:'约 3,600 公里 / 飞行 5 小时', bestSeason:'11-3月干季', hotelBudget:'¥250-500/晚', stayArea:'告庄西双景', spot:'中科院热带植物园、野象谷' },
  { type:'scenic', name:'三清山', province:'江西省', nearCity:'上饶(玉山/三清山景区)', level:'5A(示意)', distance:'约 2,000 公里 / 飞行 3.5 小时', bestSeason:'4-11月', hotelBudget:'¥200-400/晚', stayArea:'外双溪/金沙服务区', spot:'阳光海岸、巨蟒出山、南清园' },
  { type:'scenic', name:'婺源篁岭', province:'江西省', nearCity:'上饶市(婺源县)', level:'5A(示意)', distance:'约 2,000 公里 / 飞行 3.5 小时', bestSeason:'3-4月晒秋/油菜花', hotelBudget:'¥180-350/晚', stayArea:'篁岭景区', spot:'索道、天街、晒秋人家' }
];

// —— 3) 人口（七普；只对城市使用，缺失回退到文本/空） ——
const POP2020 = { "北京":21893095, "上海":24870895, "广州":18676605, "深圳":17560061, "成都":20937757, "重庆":32054159, "天津":13866009, "武汉":12326500, "西安":12952907, "苏州":12750000, "郑州":12600574, "杭州":11936010, "宁波":9404283, "佛山":9498863, "东莞":10466625, "南京":9314685, "青岛":10071722, "济南":9202432, "合肥":9369881, "沈阳":9070093, "哈尔滨":10009854 };

// —— 4) 景点简介/等级（示意；未列出则显示“简介待补充”） ——
const SPOT_META = {
  "迎客松":{level:'—',desc:'黄山象征性古松，位于玉屏楼景区。'}, "西海大峡谷":{level:'—',desc:'黄山最惊艳步道区，奇峰密布，云海翻涌。'}, "光明顶":{level:'—',desc:'黄山第二高峰，观日出与云海胜地。'},
  "南天门":{level:'—',desc:'泰山天街门阙，穿门见天海奇观。'}, "岱庙":{level:'—',desc:'泰山脚下道教庙宇群，祭祀礼制中心。'}, "十八盘":{level:'—',desc:'著名陡坡石阶路段，象征“拔仙上天”。'},
  "四方街":{level:'—',desc:'丽江古城中心广场，水系纵横。'}, "木府":{level:'—',desc:'纳西王府旧址，院落与彩绘精美。'}, "黑龙潭":{level:'—',desc:'玉龙雪山倒影名拍摄点。'},
  "洱海":{level:'—',desc:'高原淡水湖，环湖骑行与拍照热门。'}, "崇圣寺三塔":{level:'—',desc:'南诏古国佛寺地标，三塔鼎立。'}, "喜洲古镇":{level:'—',desc:'白族民居古村与田园风光。'},
  "第20窟":{level:'—',desc:'云冈石窟代表性露天大佛造像。'}, "昙曜五窟":{level:'—',desc:'早期五座主窟，艺术风格统一。'}, "灵岩寺":{level:'—',desc:'大同郊外古寺，石刻造像丰富。'},
  "五花海":{level:'—',desc:'九寨沟颜值天花板，水色斑斓。'}, "镜海":{level:'—',desc:'清晨如镜，倒影清澈。'}, "诺日朗瀑布":{level:'—',desc:'宽幅瀑布群，水汽氤氲。'},
  "五彩池":{level:'—',desc:'黄龙标志性彩池群，矿物质沉积形成。'},
  "仙乃日":{level:'—',desc:'三座神山之一，冰川与草甸相伴。'}, "央迈勇":{level:'—',desc:'雪峰尖利如矛，圣洁壮美。'}, "夏诺多吉":{level:'—',desc:'三怙主之一，形似金字塔。'},
  "金顶":{level:'—',desc:'峨眉山最高峰，云海佛光可遇。'}, "报国寺":{level:'—',desc:'山门附近古刹，香火鼎盛。'}, "凌云寺":{level:'—',desc:'乐山大佛所在寺院，临江而建。'},
  "紫霄宫":{level:'—',desc:'武当山核心宫观，紫气东来之象。'}, "南岩宫":{level:'—',desc:'悬岩之上道观建筑群。'},
  "天游峰":{level:'—',desc:'武夷群峰观景台，九曲溪全览。'}, "九曲溪":{level:'—',desc:'竹筏漂流于丹霞峡谷间。'},
  "含鄱口":{level:'—',desc:'远眺鄱阳湖与五老峰的最佳平台。'}, "三叠泉":{level:'—',desc:'庐山落差最大瀑布，分三折奔流。'},
  "篁岭梯田":{level:'—',desc:'晒秋闻名的山地梯田村落。'},
  "日升昌票号":{level:'—',desc:'中国最早票号之一，晋商金融遗迹。'},
  "虹桥":{level:'—',desc:'凤凰古城标志性风雨桥。'},
  "云龙地缝":{level:'—',desc:'地表裂隙奇观，峡谷纵深壮观。'},
  "红石峡":{level:'—',desc:'典型红色石灰岩峡谷，地貌奇特。'},
  "七彩丹霞景区":{level:'—',desc:'彩条纹地貌最佳观景点群。'},
  "莫高窟":{level:'—',desc:'敦煌石窟艺术宝库，壁画彩塑宏富。'}, "鸣沙山月牙泉":{level:'—',desc:'沙丘与月牙状湖泊并存奇景。'},
  "额尔古纳湿地":{level:'—',desc:'中国面积最大湿地之一。'},
  "梅峰岛":{level:'—',desc:'登高俯瞰千岛棋布。'},
  "烟雨长廊":{level:'—',desc:'西塘标志性临水廊棚街道。'},
  "金佛顶":{level:'—',desc:'龙脊梯田最高观景点之一。'},
  "最北邮局":{level:'—',desc:'中国最北端邮局打卡地。'},
  "中科院热带植物园":{level:'—',desc:'热带植物多样性展示园区。'}
};

// —— 5) 连游推荐（显式优先；未配置则按同省/同区域/最近城市补齐） ——
const NEARBY = {
  // 城市部分（节选，保留 v2 的配置即可）
  "北京":["天津","保定","秦皇岛"], "上海":["苏州","嘉兴","杭州"], "广州":["佛山","东莞","深圳"], "深圳":["东莞","广州","珠海"],
  "杭州":["上海","苏州","宁波"], "成都":["重庆","贵阳","西安"], "重庆":["成都","合川(重庆)","贵阳"], "武汉":["长沙","南昌","郑州"],
  "西安":["郑州","洛阳","太原"], "苏州":["上海","无锡","常州"], "南京":["苏州","合肥","扬州"], "天津":["北京","秦皇岛","保定"],
  // 景区新增
  "黄山":["杭州","千岛湖","宏村(黄山)"],
  "泰山":["济南","曲阜","青岛"],
  "丽江古城":["大理","玉龙雪山","泸沽湖(宁蒗)"],
  "大理":["丽江古城","洱海(环湖)","喜洲古镇"],
  "云冈石窟":["悬空寺/恒山","平遥古城","太原"],
  "悬空寺/恒山":["云冈石窟","大同古城","应县木塔"],
  "九寨沟":["黄龙","成都","松潘/川主寺"],
  "黄龙":["九寨沟","松潘古城","若尔盖草原"],
  "稻城亚丁":["新都桥","理塘","康定"],
  "峨眉山 & 乐山大佛":["成都","乐山城区","都江堰"],
  "武当山":["十堰","神农架","襄阳"],
  "武夷山":["南平/建阳","厦门","福州"],
  "庐山":["南昌","九江","景德镇"],
  "婺源":["黄山","宏村(黄山)","三清山"],
  "平遥古城":["太原","乔家大院(祁县)","王家大院(灵石)"],
  "凤凰古城":["张家界","芙蓉镇","吉首德夯"],
  "恩施大峡谷":["清江画廊","梭布垭石林","重庆"],
  "云台山":["开封","洛阳","郑州"],
  "张掖丹霞":["嘉峪关","敦煌莫高窟","祁连山草原"],
  "敦煌莫高窟":["鸣沙山月牙泉","张掖丹霞","嘉峪关"],
  "呼伦贝尔大草原":["满洲里","阿尔山","海拉尔"],
  "千岛湖":["黄山","杭州","淳安枫树岭"],
  "西塘古镇":["乌镇","嘉兴","上海"],
  "龙脊梯田":["桂林","阳朔","三江侗寨"],
  "漠河北极村":["兴安北极村景区","漠河市区","呼伦贝尔"],
  "西双版纳":["普洱","版纳热带雨林国家公园","打洛中缅口岸"],
  "三清山":["婺源","景德镇","上饶婺源江湾"],
  "婺源篁岭":["江岭梯田","月亮湾","思溪延村"]
};

/********************
 *  工具函数层
 ********************/
const KEY = 'china-travel-favs-v3';
const $ = (sel, root=document) => root.querySelector(sel);
function csvEscape(v){ return String(v).replace(/"/g,'""'); }
function formatPopNumber(n){ const num=Number(n); if(!Number.isFinite(num)) return null; return num.toLocaleString('zh-CN')+`（约${(num/10000).toFixed(1)}万人）`; }
function popOf(item){ if(item.type!=='city') return null; if(POP2020[item.name]) return formatPopNumber(POP2020[item.name]); return item.population || null; }
function baikeCityLink(name){ return 'https://baike.baidu.com/item/'+encodeURIComponent(name); }
function cleanSpot(n){ return n.replace(/\(.*?\)|（.*?）/g,''); }
function baikeSpotLink(spot){ const key=cleanSpot(spot); return 'https://baike.baidu.com/item/'+encodeURIComponent(key); }
function spotListFor(item){ return (item.spot||'').split('、').map(s=>s.trim()).filter(Boolean); }
function spotDesc(name){ return (SPOT_META[name]&&SPOT_META[name].desc) || '简介待补充'; }
function spotLevel(name){ return (SPOT_META[name]&&SPOT_META[name].level) || '—'; }
function nearbyFor(name, base){
  const explicit = NEARBY[name];
  if(explicit && explicit.length) return explicit.slice(0,3);
  const item = base.find(c=>c.name===name); if(!item) return [];
  const sameProv = base.filter(c=>c.province===item.province && c.name!==name).map(c=>c.name).slice(0,3);
  if(sameProv.length>=3) return sameProv.slice(0,3);
  const candidates = base.filter(c=>c.location && c.location===item.location && c.name!==name).map(c=>c.name);
  const merged = [...sameProv, ...candidates];
  const uniq=[]; for(const n of merged){ if(!uniq.includes(n) && uniq.length<3) uniq.push(n); }
  if(uniq.length<3){ for(const c of base){ if(c.name!==name && !uniq.includes(c.name)){ uniq.push(c.name); if(uniq.length===3) break; } } }
  return uniq;
}

/********************
 *  视图渲染层
 ********************/
function kv(key, val){ return `<div class="key">${key}</div><div>${val}</div>`; }
function kvMaybe(key, val){ if(val==null||val==='') return ''; return kv(key, val); }
function panelHTML(item, ALL){
  const spots = spotListFor(item);
  const near = nearbyFor(item.name, ALL);
  const popText = popOf(item);
  return `
    <div class="title">推荐目的地：${item.name}${item.type==='scenic'?'<span class="badge">景区</span>':'<span class="badge">城市</span>'}</div>
    <div class="kvs">
      ${kv('距离/航程', item.distance||'—')}
      ${kvMaybe('人均GDP', item.gdp)}
      ${kvMaybe('著名景点', item.spot)}
      ${kvMaybe('10月平均气温', item.temp?String(item.temp).replace('10月：',''):'')}
      ${kvMaybe('著名美食', item.food)}
      ${kvMaybe('人口（七普/近似）', popText)}
      ${kvMaybe('省份/属性', item.province)}
      ${kvMaybe('地理位置', item.location)}
      ${kvMaybe('最佳季节', item.bestSeason)}
      ${kvMaybe('经济型酒店均价', item.hotelBudget)}
      ${kvMaybe('建议住宿区域', item.stayArea)}
      ${kv('同游推荐', near.map(n=>`<a href="${baikeCityLink(n)}" target="_blank" rel="noopener">${n}</a>`).join('、'))}
    </div>
    ${spots.length?`<details class="spots"><summary>展开：景点简介与百科</summary>
      <div class="spot-list">${spots.map(n=>`<div class="spot-item"><div class="name">${n} <span class="badge">${spotLevel(n)}</span></div><div class="sub">${spotDesc(n)}</div><a href="${baikeSpotLink(n)}" target="_blank" rel="noopener">在百度百科查看</a></div>`).join('')}</div>
    </details>`:''}
  `;
}
function favCardHTML(item, ALL){
  return `
  <div class="fav">
    <div class="title">${item.name} ${item.type==='scenic'?'<span class="badge">景区</span>':'<span class="badge">城市</span>'}</div>
    <div class="meta">${[item.province,item.location].filter(Boolean).join('｜')||'—'}</div>
    <div class="kvs">
      ${kv('距离/航程', item.distance||'—')}
      ${kvMaybe('人均GDP', item.gdp)}
      ${kvMaybe('10月', item.temp?String(item.temp).replace('10月：',''):'')}
      ${kvMaybe('美食', item.food)}
      ${kvMaybe('人口', popOf(item))}
      ${kvMaybe('景点', item.spot)}
      ${kvMaybe('最佳季节', item.bestSeason)}
      ${kvMaybe('酒店均价', item.hotelBudget)}
      ${kvMaybe('住宿区域', item.stayArea)}
      ${kv('同游', nearbyFor(item.name, ALL).map(n=>`<a href="${baikeCityLink(n)}" target="_blank" rel="noopener">${n}</a>`).join('、'))}
    </div>
    <div class="row" style="margin-top:8px"><button data-remove="${item.name}">删除</button></div>
  </div>`;
}

/********************
 *  控制层
 ********************/
const $current = document.getElementById('current');
const $favs = document.getElementById('favorites');
const $roll = document.getElementById('btn-roll');
const $fav = document.getElementById('btn-fav');
const $export = document.getElementById('btn-export');
const $search = document.getElementById('search');
const $picker = document.getElementById('picker');
const $pickBtn = document.getElementById('btn-pick');
const $clearBtn = document.getElementById('btn-clear');
const $nameList = document.getElementById('name-list');
const $filter = document.getElementById('filter-type');

let ALL = [...CITIES, ...SCENIC];
let state = { current: ALL[Math.floor(Math.random()*ALL.length)], favorites: [], filter:'all' };

try{ const raw=localStorage.getItem(KEY); if(raw) state.favorites = JSON.parse(raw)||[]; }catch{}
function saveFavs(){ try{ localStorage.setItem(KEY, JSON.stringify(state.favorites)); }catch{} }

function applyFilter(){
  if(state.filter==='city') return CITIES;
  if(state.filter==='scenic') return SCENIC;
  return ALL;
}

function renderCurrent(){
  const list = applyFilter();
  // 如果当前项目不在筛选范围，切到该范围随机一条
  if(!list.find(x=>x.name===state.current.name)){
    state.current = list[Math.floor(Math.random()*list.length)] || state.current;
  }
  $fav.textContent = state.favorites.some(f=>f.name===state.current.name) ? '取消收藏' : '收藏';
  $current.innerHTML = panelHTML(state.current, ALL);
}
function renderFavs(){
  const q = ($search.value||'').trim();
  const list = q ? state.favorites.filter(f=>f.name.includes(q)) : state.favorites;
  if(!list.length){ $favs.innerHTML = '<div class="meta">暂无收藏或无搜索结果。</div>'; return; }
  $favs.innerHTML = list.map(c=>favCardHTML(c, ALL)).join('');
  $favs.querySelectorAll('button[data-remove]').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      const name = btn.getAttribute('data-remove');
      state.favorites = state.favorites.filter(f=>f.name!==name);
      saveFavs(); renderFavs(); renderCurrent();
    });
  });
}
function fillDatalist(){ $nameList.innerHTML = ALL.map(c=>`<option value="${c.name}"></option>`).join(''); }

// 事件绑定
$roll.addEventListener('click', ()=>{ const list=applyFilter(); state.current = list[Math.floor(Math.random()*list.length)]; renderCurrent(); });
$fav.addEventListener('click', ()=>{ const i=state.favorites.findIndex(f=>f.name===state.current.name); if(i>=0) state.favorites.splice(i,1); else state.favorites.unshift(state.current); state.favorites=state.favorites.slice(0,200); saveFavs(); renderCurrent(); renderFavs(); });
$search.addEventListener('input', renderFavs);
$pickBtn.addEventListener('click', ()=> selectByName($picker.value));
$picker.addEventListener('keydown', e=>{ if(e.key==='Enter') selectByName($picker.value); });
$clearBtn.addEventListener('click', ()=>{ $picker.value=''; $picker.focus(); });
$filter.addEventListener('change', ()=>{ state.filter=$filter.value; renderCurrent(); });

function selectByName(name){ if(!name) return; const list = applyFilter(); const exact = list.find(c=>c.name===name.trim()) || ALL.find(c=>c.name===name.trim()); const fuzzy = exact || list.find(c=>c.name.includes(name.trim())) || ALL.find(c=>c.name.includes(name.trim())); if(fuzzy){ state.current=fuzzy; renderCurrent(); } else { alert('未找到该目的地，请检查输入（例如：北京、黄山、丽江）'); } }

// CSV 导出（新增类型/最佳季节/酒店/住宿区域）
$export.addEventListener('click', ()=>{
  if(!state.favorites.length){ alert('没有可导出的收藏。'); return; }
  const header = ['类型','名称','省份/属性','地理位置','距离/航程','人均GDP','10月平均气温','著名美食','人口','景点','最佳季节','酒店均价','住宿区域','同游推荐'];
  const rows = state.favorites.map(c=>[
    c.type==='scenic'?'景区':'城市', c.name, c.province||'', c.location||'', c.distance||'', c.gdp||'', (c.temp?String(c.temp).replace('10月：',''):'')||'', c.food||'', popOf(c)||'', c.spot||'', c.bestSeason||'', c.hotelBudget||'', c.stayArea||'', nearbyFor(c.name, ALL).join(' / ')
  ]);
  const csv = [header.join(','), ...rows.map(r=>r.map(v=>`"${csvEscape(v)}"`).join(','))].join('\n');
  const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href=url; a.download='收藏目的地.csv'; a.click(); URL.revokeObjectURL(url);
});

// 初次渲染
fillDatalist();
renderCurrent();
renderFavs();
</script>

</body>
</html>
