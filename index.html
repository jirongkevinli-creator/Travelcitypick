<!doctype html>
<html lang="zh">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>中国旅游推荐（从延吉出发）</title>
  <style>
    :root { --bg:#fafbff; --card:#ffffff; --ink:#0f172a; --muted:#64748b; --line:#e5e7eb; --accent:#2563eb; }
    *{ box-sizing:border-box }
    body{ margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, Noto Sans, "Apple Color Emoji","Segoe UI Emoji"; background:var(--bg); color:var(--ink); }
    .wrap{ max-width:1100px; margin:0 auto; padding:24px; }
    header{ display:flex; flex-wrap:wrap; align-items:flex-end; justify-content:space-between; gap:12px; }
    h1{ margin:0; font-size:clamp(22px, 3vw, 28px); }
    p.lead{ color:var(--muted); margin:6px 0 0; }
    .card{ background:var(--card); border:1px solid var(--line); border-radius:16px; padding:16px; box-shadow:0 1px 2px rgba(0,0,0,.04); }
    .row{ display:flex; flex-wrap:wrap; gap:8px; align-items:center; }
    .row > *{ margin:4px 0; }
    button{ appearance:none; border:1px solid var(--line); background:#fff; color:var(--ink); padding:10px 14px; border-radius:12px; cursor:pointer; font-weight:600; }
    button.primary{ background:var(--accent); color:#fff; border-color:var(--accent); }
    button.ghost{ background:transparent; }
    button:disabled{ opacity:.6; cursor:not-allowed; }
    input{ width:100%; max-width:360px; padding:10px 12px; border:1px solid var(--line); border-radius:10px; }
    .grid{ display:grid; grid-template-columns:repeat(auto-fill, minmax(280px,1fr)); gap:12px; }
    .fav{ border:1px dashed var(--line); border-radius:12px; padding:12px; }
    .meta{ color:var(--muted); font-size:14px; }
    .kvs{ margin:8px 0 0; display:grid; grid-template-columns: 150px 1fr; gap:6px 10px; font-size:14px; }
    .kvs div{ padding:2px 0; }
    .kvs .key{ color:var(--muted); }
    .title{ font-weight:700; font-size:18px; }
    .spacer{ height:8px; }
    footer{ color:var(--muted); font-size:13px; margin-top:18px; }

    /* 景点图文卡片与百科链接 */
    details.spots{ margin-top:10px; }
    details.spots summary{ cursor:pointer; color:var(--accent); }
    .spot-grid{ display:grid; grid-template-columns:repeat(auto-fill, minmax(220px,1fr)); gap:10px; margin-top:10px; }
    .spot-card{ border:1px solid var(--line); border-radius:12px; overflow:hidden; background:#fff; box-shadow:0 1px 2px rgba(0,0,0,.03); }
    .spot-img{ width:100%; height:140px; object-fit:cover; display:block; background:#f1f5f9; }
    .spot-card figcaption{ padding:8px 10px; font-size:14px; display:flex; justify-content:space-between; align-items:center; gap:8px; }
    .badge{ display:inline-block; border:1px solid var(--line); border-radius:999px; padding:0 8px; font-size:12px; margin-left:6px; color:#075985; background:#e0f2fe; }
    .spot-card a.baike{ font-size:12px; color:var(--accent); text-decoration:none; }
    .spot-card a.baike:hover{ text-decoration:underline; }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>中国旅游推荐（从延吉出发）</h1>
        <p class="lead">随机推荐 50 个主要城市之一，显示中文旅行要点。*数据为近似示意*</p>
      </div>
      <div class="row">
        <button id="btn-roll" class="primary">再推荐</button>
        <button id="btn-fav">收藏</button>
        <button id="btn-export" class="ghost">导出收藏</button>
      </div>
    </header>

    <div class="spacer"></div>

    <!-- 快速查找城市（位于“推荐城市”上方） -->
    <div class="row card" style="gap:10px; align-items:center;">
      <input id="picker" list="city-list" placeholder="快速查找城市（输入城市名，如：北京、上海、成都）" style="flex:1; max-width:520px;" />
      <datalist id="city-list"></datalist>
      <button id="btn-pick" class="primary">选择城市</button>
      <button id="btn-clear" class="ghost">清空</button>
    </div>

    <div class="spacer"></div>

    <section id="current" class="card" aria-live="polite"></section>

    <div class="spacer"></div>

    <div class="row">
      <input id="search" placeholder="搜索收藏 (例: 北京、上海)" />
    </div>

    <h3>收藏</h3>
    <section id="favorites" class="grid" aria-live="polite"></section>

    <footer>提示：人口为 2020 年第七次全国人口普查“全市常住人口”；酒店均价与景点评级为经验/参考示意；收藏仅保存在浏览器本地。</footer>
  </div>

  <script>
    // ======= 基础城市数据（人口字段由 popOf 动态渲染） =======
    const DATA = [
      { name: "北京", distance: "约 1,500 公里 / 飞行 2 小时", gdp: "人均GDP：约 ¥180,000", spot: "故宫、长城", temp: "10月：12℃", food: "北京烤鸭", population: "约 2,200 万", province: "直辖市·北京", location: "华北地区" },
      { name: "上海", distance: "约 1,800 公里 / 飞行 2.5 小时", gdp: "人均GDP：约 ¥190,000", spot: "外滩、东方明珠", temp: "10月：19℃", food: "生煎、小笼包", population: "约 2,500 万", province: "直辖市·上海", location: "华东沿海" },
      { name: "广州", distance: "约 2,800 公里 / 飞行 3.5 小时", gdp: "人均GDP：约 ¥170,000", spot: "广州塔、沙面", temp: "10月：26℃", food: "早茶、烧鹅", population: "约 1,900 万", province: "广东省", location: "华南沿海" },
      { name: "深圳", distance: "约 2,900 公里 / 飞行 3.5 小时", gdp: "人均GDP：约 ¥220,000", spot: "深圳湾、公园群", temp: "10月：26℃", food: "海鲜、客家菜", population: "约 1,750 万", province: "广东省", location: "珠三角" },
      { name: "杭州", distance: "约 1,900 公里 / 飞行 2.5 小时", gdp: "人均GDP：约 ¥180,000", spot: "西湖、灵隐寺", temp: "10月：19℃", food: "西湖醋鱼、东坡肉", population: "约 1,220 万", province: "浙江省", location: "华东沿海" },
      { name: "成都", distance: "约 2,800 公里 / 飞行 3.5 小时", gdp: "人均GDP：约 ¥120,000", spot: "大熊猫基地、锦里", temp: "10月：18℃", food: "火锅、串串", population: "约 2,100 万", province: "四川省", location: "西南地区" },
      { name: "重庆", distance: "约 2,700 公里 / 飞行 3.5 小时", gdp: "人均GDP：约 ¥100,000", spot: "洪崖洞、解放碑", temp: "10月：20℃", food: "重庆火锅、小面", population: "约 3,100 万", province: "直辖市·重庆", location: "西南地区" },
      { name: "武汉", distance: "约 2,200 公里 / 飞行 3 小时", gdp: "人均GDP：约 ¥130,000", spot: "黄鹤楼、东湖", temp: "10月：20℃", food: "热干面、鸭脖", population: "约 1,300 万", province: "湖北省", location: "华中地区" },
      { name: "西安", distance: "约 2,200 公里 / 飞行 3 小时", gdp: "人均GDP：约 ¥110,000", spot: "兵马俑、古城墙", temp: "10月：14℃", food: "肉夹馍、凉皮", population: "约 1,300 万", province: "陕西省", location: "西北地区" },
      { name: "苏州", distance: "约 1,900 公里 / 飞行 2.5 小时", gdp: "人均GDP：约 ¥200,000", spot: "拙政园、周庄", temp: "10月：19℃", food: "苏式面、松鼠桂鱼", population: "约 1,300 万", province: "江苏省", location: "长三角" },
      { name: "南京", distance: "约 1,950 公里 / 飞行 2.5 小时", gdp: "人均GDP：约 ¥170,000", spot: "中山陵、夫子庙", temp: "10月：19℃", food: "盐水鸭、鸭血粉丝汤", population: "约 950 万", province: "江苏省", location: "华东地区" },
      { name: "天津", distance: "约 1,600 公里 / 飞行 2 小时", gdp: "人均GDP：约 ¥120,000", spot: "意式风情区、海河", temp: "10月：14℃", food: "煎饼果子、耳朵眼炸糕", population: "约 1,380 万", province: "直辖市·天津", location: "环渤海" },
      { name: "郑州", distance: "约 2,000 公里 / 飞行 3 小时", gdp: "人均GDP：约 ¥110,000", spot: "少林寺(登封)", temp: "10月：17℃", food: "胡辣汤", population: "约 1,300 万", province: "河南省", location: "华中地区" },
      { name: "长沙", distance: "约 2,300 公里 / 飞行 3 小时", gdp: "人均GDP：约 ¥120,000", spot: "岳麓山、橘子洲", temp: "10月：21℃", food: "口味虾、剁椒鱼头", population: "约 1,000 万", province: "湖南省", location: "华中地区" },
      { name: "宁波", distance: "约 1,950 公里 / 飞行 2.5 小时", gdp: "人均GDP：约 ¥190,000", spot: "天一阁、老外滩", temp: "10月：20℃", food: "海鲜、汤圆", population: "约 950 万", province: "浙江省", location: "华东沿海" },
      { name: "厦门", distance: "约 2,300 公里 / 飞行 3 小时", gdp: "人均GDP：约 ¥180,000", spot: "鼓浪屿", temp: "10月：25℃", food: "沙茶面、花生汤", population: "约 500 万", province: "福建省", location: "东南沿海" },
      { name: "福州", distance: "约 2,200 公里 / 飞行 3 小时", gdp: "人均GDP：约 ¥150,000", spot: "三坊七巷", temp: "10月：23℃", food: "佛跳墙、鱼丸", population: "约 800 万", province: "福建省", location: "东南沿海" },
      { name: "哈尔滨", distance: "约 500 公里 / 飞行 1 小时", gdp: "人均GDP：约 ¥90,000", spot: "冰雪大世界", temp: "10月：6℃", food: "红肠、锅包肉", population: "约 950 万", province: "黑龙江省", location: "东北地区" },
      { name: "沈阳", distance: "约 400 公里 / 飞行 1 小时", gdp: "人均GDP：约 ¥100,000", spot: "故宫(沈阳)", temp: "10月：10℃", food: "老四样、鸡架", population: "约 920 万", province: "辽宁省", location: "东北地区" },
      { name: "大连", distance: "约 650 公里 / 飞行 1.5 小时", gdp: "人均GDP：约 ¥130,000", spot: "星海广场、滨海路", temp: "10月：14℃", food: "海鲜、焖子", population: "约 750 万", province: "辽宁省", location: "渤海沿海" },
      { name: "青岛", distance: "约 1,200 公里 / 飞行 2 小时", gdp: "人均GDP：约 ¥150,000", spot: "栈桥、崂山", temp: "10月：17℃", food: "啤酒、海鲜", population: "约 1,000 万", province: "山东省", location: "华东沿海" },
      { name: "济南", distance: "约 1,400 公里 / 飞行 2 小时", gdp: "人均GDP：约 ¥130,000", spot: "趵突泉、千佛山", temp: "10月：16℃", food: "把子肉、甜沫", population: "约 920 万", province: "山东省", location: "华东地区" },
      { name: "合肥", distance: "约 1,800 公里 / 飞行 2.5 小时", gdp: "人均GDP：约 ¥120,000", spot: "三河古镇", temp: "10月：18℃", food: "庐州烤鸭、鸭油烧饼", population: "约 960 万", province: "安徽省", location: "华东地区" },
      { name: "昆明", distance: "约 3,100 公里 / 飞行 4 小时", gdp: "人均GDP：约 ¥100,000", spot: "滇池、石林", temp: "10月：16℃", food: "过桥米线", population: "约 850 万", province: "云南省", location: "西南高原" },
      { name: "贵阳", distance: "约 2,900 公里 / 飞行 3.5 小时", gdp: "人均GDP：约 ¥95,000", spot: "甲秀楼、青岩古镇", temp: "10月：16℃", food: "酸汤鱼", population: "约 600 万", province: "贵州省", location: "西南地区" },
      { name: "南宁", distance: "约 3,200 公里 / 飞行 4 小时", gdp: "人均GDP：约 ¥95,000", spot: "南湖公园、青秀山", temp: "10月：25℃", food: "老友粉", population: "约 880 万", province: "广西壮族自治区", location: "华南边疆" },
      { name: "无锡", distance: "约 1,950 公里 / 飞行 2.5 小时", gdp: "人均GDP：约 ¥200,000", spot: "太湖、灵山大佛", temp: "10月：19℃", food: "酱排骨、小笼包", population: "约 750 万", province: "江苏省", location: "长三角" },
      { name: "长春", distance: "约 300 公里 / 飞行 1 小时", gdp: "人均GDP：约 ¥90,000", spot: "净月潭", temp: "10月：8℃", food: "锅包肉、酱骨头", population: "约 900 万", province: "吉林省", location: "东北地区" },
      { name: "石家庄", distance: "约 1,800 公里 / 飞行 2.5 小时", gdp: "人均GDP：约 ¥100,000", spot: "赵州桥、抱犊寨", temp: "10月：14℃", food: "驴肉火烧", population: "约 1,100 万", province: "河北省", location: "华北地区" },
      { name: "太原", distance: "约 2,000 公里 / 飞行 3 小时", gdp: "人均GDP：约 ¥100,000", spot: "晋祠、双塔寺", temp: "10月：12℃", food: "刀削面", population: "约 550 万", province: "山西省", location: "华北地区" },
      { name: "兰州", distance: "约 2,600 公里 / 飞行 3.5 小时", gdp: "人均GDP：约 ¥95,000", spot: "黄河铁桥、五泉山", temp: "10月：10℃", food: "兰州拉面", population: "约 440 万", province: "甘肃省", location: "西北地区" },
      { name: "银川", distance: "约 2,600 公里 / 飞行 3.5 小时", gdp: "人均GDP：约 ¥100,000", spot: "沙湖、西夏王陵", temp: "10月：11℃", food: "手抓羊肉", population: "约 280 万", province: "宁夏回族自治区", location: "西北地区" },
      { name: "西宁", distance: "约 2,900 公里 / 飞行 4 小时", gdp: "人均GDP：约 ¥95,000", spot: "青海湖、塔尔寺", temp: "10月：7℃", food: "牦牛肉", population: "约 240 万", province: "青海省", location: "青藏高原东部" },
      { name: "呼和浩特", distance: "约 2,100 公里 / 飞行 3 小时", gdp: "人均GDP：约 ¥100,000", spot: "大召寺、昭君博物院", temp: "10月：9℃", food: "手把肉、奶茶", population: "约 350 万", province: "内蒙古自治区", location: "华北边缘" },
      { name: "保定", distance: "约 1,700 公里 / 飞行 2.5 小时", gdp: "人均GDP：约 ¥90,000", spot: "古莲花池", temp: "10月：13℃", food: "驴肉火烧", population: "约 1,100 万", province: "河北省", location: "京津冀" },
      { name: "扬州", distance: "约 2,000 公里 / 飞行 3 小时", gdp: "人均GDP：约 ¥120,000", spot: "瘦西湖", temp: "10月：18℃", food: "扬州炒饭、早茶", population: "约 460 万", province: "江苏省", location: "长江下游" },
      { name: "常州", distance: "约 1,980 公里 / 飞行 2.5 小时", gdp: "人均GDP：约 ¥160,000", spot: "中华恐龙园", temp: "10月：18℃", food: "麻糕、阳湖鹅", population: "约 540 万", province: "江苏省", location: "长三角" },
      { name: "南通", distance: "约 2,000 公里 / 飞行 3 小时", gdp: "人均GDP：约 ¥150,000", spot: "狼山、濠河", temp: "10月：18℃", food: "文蛤、江鲜", population: "约 730 万", province: "江苏省", location: "长江入海口北翼" },
      { name: "威海", distance: "约 1,100 公里 / 飞行 2 小时", gdp: "人均GDP：约 ¥140,000", spot: "刘公岛", temp: "10月：16℃", food: "海参、海带", population: "约 280 万", province: "山东省", location: "胶东半岛东端" },
      { name: "烟台", distance: "约 1,100 公里 / 飞行 2 小时", gdp: "人均GDP：约 ¥140,000", spot: "蓬莱阁、长岛", temp: "10月：16℃", food: "海鲜、苹果制品", population: "约 700 万", province: "山东省", location: "胶东半岛" },
      { name: "嘉兴", distance: "约 1,950 公里 / 飞行 2.5 小时", gdp: "人均GDP：约 ¥170,000", spot: "乌镇", temp: "10月：19℃", food: "粽子、酱鸭", population: "约 560 万", province: "浙江省", location: "杭嘉湖平原" },
      { name: "温州", distance: "约 2,050 公里 / 飞行 3 小时", gdp: "人均GDP：约 ¥130,000", spot: "雁荡山、楠溪江", temp: "10月：22℃", food: "鱼丸、海鲜", population: "约 950 万", province: "浙江省", location: "东南沿海" },
      { name: "惠州", distance: "约 2,850 公里 / 飞行 3.5 小时", gdp: "人均GDP：约 ¥120,000", spot: "西湖、双月湾", temp: "10月：26℃", food: "客家酿豆腐", population: "约 600 万", province: "广东省", location: "珠三角东部" },
      { name: "东莞", distance: "约 2,850 公里 / 飞行 3.5 小时", gdp: "人均GDP：约 ¥180,000", spot: "虎门大桥、松山湖", temp: "10月：26℃", food: "肠粉、烧鹅", population: "约 1,000 万", province: "广东省", location: "珠三角" },
      { name: "佛山", distance: "约 2,800 公里 / 飞行 3.5 小时", gdp: "人均GDP：约 ¥160,000", spot: "祖庙、顺德水乡", temp: "10月：26℃", food: "双皮奶、顺德菜", population: "约 950 万", province: "广东省", location: "珠三角" },
      { name: "珠海", distance: "约 2,950 公里 / 飞行 3.5 小时", gdp: "人均GDP：约 ¥200,000", spot: "日月贝、情侣路", temp: "10月：26℃", food: "海鲜、葡式蛋挞", population: "约 250 万", province: "广东省", location: "珠江西岸" },
      { name: "乌鲁木齐", distance: "约 4,700 公里 / 飞行 5.5 小时", gdp: "人均GDP：约 ¥120,000", spot: "天山天池", temp: "10月：7℃", food: "抓饭、烤肉", population: "约 400 万", province: "新疆维吾尔自治区", location: "欧亚内陆中心" },
      { name: "三亚", distance: "约 4,600 公里 / 飞行 5.5 小时", gdp: "人均GDP：约 ¥120,000", spot: "亚龙湾、天涯海角", temp: "10月：27℃", food: "海鲜、清补凉", population: "约 120 万", province: "海南省", location: "南端海滨" },
      { name: "海口", distance: "约 4,400 公里 / 飞行 5 小时", gdp: "人均GDP：约 ¥110,000", spot: "骑楼老街", temp: "10月：27℃", food: "椰子鸡、清补凉", population: "约 280 万", province: "海南省", location: "北部海滨" },
      { name: "桂林", distance: "约 3,200 公里 / 飞行 4 小时", gdp: "人均GDP：约 ¥90,000", spot: "漓江、阳朔", temp: "10月：22℃", food: "米粉、田螺", population: "约 500 万", province: "广西壮族自治区", location: "华南喀斯特" },
      { name: "张家界", distance: "约 3,000 公里 / 飞行 4 小时", gdp: "人均GDP：约 ¥85,000", spot: "武陵源景区", temp: "10月：18℃", food: "三下锅", population: "约 160 万", province: "湖南省", location: "武陵山脉" },
      { name: "洛阳", distance: "约 2,100 公里 / 飞行 3 小时", gdp: "人均GDP：约 ¥100,000", spot: "龙门石窟", temp: "10月：16℃", food: "水席", population: "约 700 万", province: "河南省", location: "中原西部" },
      { name: "开封", distance: "约 2,000 公里 / 飞行 3 小时", gdp: "人均GDP：约 ¥90,000", spot: "清明上河园", temp: "10月：16℃", food: "灌汤包", population: "约 500 万", province: "河南省", location: "中原东部" },
      { name: "南昌", distance: "约 2,200 公里 / 飞行 3 小时", gdp: "人均GDP：约 ¥110,000", spot: "滕王阁", temp: "10月：20℃", food: "拌粉、瓦罐汤", population: "约 650 万", province: "江西省", location: "华中南部" },
      { name: "合川(重庆)", distance: "约 2,700 公里 / 飞行 3.5 小时", gdp: "人均GDP：约 ¥95,000", spot: "钓鱼城遗址", temp: "10月：19℃", food: "江湖菜", population: "约 150 万", province: "重庆市", location: "嘉陵江沿岸" },
      { name: "秦皇岛", distance: "约 1,500 公里 / 飞行 2 小时", gdp: "人均GDP：约 ¥100,000", spot: "老龙头、北戴河", temp: "10月：14℃", food: "海鲜", population: "约 300 万", province: "河北省", location: "渤海湾" },
      { name: "绍兴", distance: "约 2,000 公里 / 飞行 3 小时", gdp: "人均GDP：约 ¥170,000", spot: "鲁迅故里、东湖", temp: "10月：19℃", food: "黄酒、臭豆腐", population: "约 500 万", province: "浙江省", location: "浙东平原" },
      { name: "舟山", distance: "约 2,100 公里 / 飞行 3 小时", gdp: "人均GDP：约 ¥160,000", spot: "普陀山", temp: "10月：20℃", food: "海鲜", population: "约 110 万", province: "浙江省", location: "东海群岛" },
      { name: "肇庆", distance: "约 2,700 公里 / 飞行 3.5 小时", gdp: "人均GDP：约 ¥110,000", spot: "七星岩", temp: "10月：26℃", food: "裹蒸粽", population: "约 400 万", province: "广东省", location: "珠江西江上游" },
      { name: "中山", distance: "约 2,900 公里 / 飞行 3.5 小时", gdp: "人均GDP：约 ¥150,000", spot: "孙中山故里", temp: "10月：26℃", food: "石岐乳鸽", population: "约 440 万", province: "广东省", location: "珠江西岸" },
      { name: "鞍山", distance: "约 500 公里 / 飞行 1 小时", gdp: "人均GDP：约 ¥95,000", spot: "千山", temp: "10月：11℃", food: "海城馅饼", population: "约 330 万", province: "辽宁省", location: "辽东半岛北部" },
      { name: "齐齐哈尔", distance: "约 700 公里 / 飞行 1.5 小时", gdp: "人均GDP：约 ¥80,000", spot: "扎龙自然保护区", temp: "10月：5℃", food: "烤肉、酸菜", population: "约 520 万", province: "黑龙江省", location: "松嫩平原" },
      { name: "大庆", distance: "约 650 公里 / 飞行 1.5 小时", gdp: "人均GDP：约 ¥130,000", spot: "油田科普园", temp: "10月：7℃", food: "东北菜", population: "约 280 万", province: "黑龙江省", location: "松嫩平原" }
    ];

    // 人口（2020七普，全市常住人口）
    const POP2020 = { "北京": 21893095, "上海": 24870895, "广州": 18676605, "深圳": 17560061, "杭州": 11936010, "成都": 20937757, "重庆": 32054159, "武汉": 12326500, "西安": 12952907, "苏州": 12748262, "南京": 9314685, "天津": 13866009, "郑州": 12600574, "长沙": 10047914, "宁波": 9404283, "厦门": 5163970, "福州": 8291268, "哈尔滨": 10009854, "沈阳": 9070093, "大连": 7450785, "青岛": 10071595, "济南": 9202432, "合肥": 9369881, "昆明": 8460088, "贵阳": 5987018, "南宁": 8741584, "无锡": 7462135, "长春": 9066517, "石家庄": 11235086, "太原": 5303592, "兰州": 4359446, "银川": 2854616, "西宁": 2467837, "呼和浩特": 3445007, "保定": 11437217, "扬州": 4559797, "常州": 5278121, "南通": 7726635, "威海": 2906548, "烟台": 7132193, "嘉兴": 5400868, "温州": 9572903, "惠州": 6042852, "东莞": 10466729, "佛山": 9498863, "珠海": 2439585, "乌鲁木齐": 4054369, "三亚": 1031396, "海口": 2873358, "桂林": 4931137, "张家界": 1526956, "洛阳": 6571799, "开封": 4368830, "南昌": 6256364, "合川(重庆)": 1532598, "秦皇岛": 3146330, "绍兴": 5058648, "舟山": 1179945, "肇庆": 4121478, "中山": 4420291, "鞍山": 3320793, "齐齐哈尔": 4921204, "大庆": 2863840 };

    // 景点：简介 + 评级（示意）
    const SPOT_META = {
      "故宫":{ level:"5A", desc:"明清两代皇宫，世界文化遗产" },
      "长城":{ level:"5A", desc:"万里长城代表段多在八达岭、慕田峪" },
      "外滩":{ level:"4A", desc:"近代万国建筑群，黄浦江畔夜景" },
      "东方明珠":{ level:"4A", desc:"地标电视塔，观景平台俯瞰浦江" },
      "广州塔":{ level:"4A", desc:"城市地标小蛮腰，塔顶观景" },
      "沙面":{ level:"4A", desc:"历史欧陆建筑街区，岭南风情" },
      "深圳湾":{ level:"—", desc:"海湾公园与滨海步道" },
      "公园群":{ level:"—", desc:"城市公园连片，亲子休闲" },
      "西湖":{ level:"5A", desc:"世界文化景观，十景遍布湖畔" },
      "灵隐寺":{ level:"4A", desc:"东晋古刹，与飞来峰石刻相邻" },
      "大熊猫基地":{ level:"5A", desc:"成都熊猫繁育研究基地" },
      "锦里":{ level:"4A", desc:"仿古街区，小吃与手作集中" },
      "洪崖洞":{ level:"4A", desc:"依山而建的吊脚楼群，夜景出片" },
      "解放碑":{ level:"4A", desc:"渝中地标商圈" },
      "黄鹤楼":{ level:"5A", desc:"江南三大名楼之一" },
      "东湖":{ level:"5A", desc:"城市内湖，绿道骑行" },
      "兵马俑":{ level:"5A", desc:"秦始皇陵陪葬坑，气势恢宏" },
      "古城墙":{ level:"5A", desc:"明城墙环城，可骑行漫步" },
      "拙政园":{ level:"5A", desc:"江南园林代表，曲水流觞" },
      "周庄":{ level:"5A", desc:"江南水乡古镇" },
      "中山陵":{ level:"5A", desc:"伟人纪念地，林荫大道宁静" },
      "夫子庙":{ level:"5A", desc:"秦淮河畔灯影繁华" },
      "意式风情区":{ level:"4A", desc:"欧式建筑街区，餐吧林立" },
      "海河":{ level:"4A", desc:"穿城母亲河，游船夜景" },
      "少林寺":{ level:"5A", desc:"禅宗祖庭，武术发源地" },
      "少林寺(登封)":{ level:"5A", desc:"禅宗祖庭，武术发源地（登封）" },
      "岳麓山":{ level:"5A", desc:"千年学府旁名山，枫叶胜景" },
      "橘子洲":{ level:"4A", desc:"湘江江心洲，烟花表演地" },
      "天一阁":{ level:"5A", desc:"中国现存最早私家藏书楼" },
      "老外滩":{ level:"—", desc:"宁波历史外滩风貌区" },
      "鼓浪屿":{ level:"5A", desc:"世界文化遗产海岛" },
      "三坊七巷":{ level:"5A", desc:"历史名人故居街区" },
      "冰雪大世界":{ level:"—", desc:"冬季冰灯雪雕乐园" },
      "故宫(沈阳)":{ level:"5A", desc:"清初皇宫，满族文化遗址" },
      "星海广场":{ level:"4A", desc:"城市客厅海滨广场" },
      "滨海路":{ level:"4A", desc:"山海相依自驾步道" },
      "栈桥":{ level:"4A", desc:"青岛象征，与老城相连" },
      "崂山":{ level:"5A", desc:"海上第一名山，道教名胜" },
      "趵突泉":{ level:"5A", desc:"天下第一泉，趵突三泉涌" },
      "千佛山":{ level:"4A", desc:"历山古称，俯瞰泉城" },
      "三河古镇":{ level:"4A", desc:"水系交汇古镇风貌" },
      "滇池":{ level:"4A", desc:"高原明珠，冬季红嘴鸥" },
      "石林":{ level:"5A", desc:"喀斯特地貌奇观" },
      "甲秀楼":{ level:"4A", desc:"明代楼阁，南明河畔" },
      "青岩古镇":{ level:"4A", desc:"石头古城，小吃丰富" },
      "南湖公园":{ level:"4A", desc:"城市绿肺夜景宜人" },
      "青秀山":{ level:"5A", desc:"城市后花园，环山步道" },
      "太湖":{ level:"5A", desc:"环太湖风景区" },
      "灵山大佛":{ level:"5A", desc:"巨型露天佛像与梵宫" },
      "净月潭":{ level:"5A", desc:"国家级森林公园" },
      "赵州桥":{ level:"5A", desc:"隋代石拱桥，工艺精绝" },
      "抱犊寨":{ level:"4A", desc:"山城古寨，太行风光" },
      "晋祠":{ level:"5A", desc:"晋文化发源地" },
      "双塔寺":{ level:"4A", desc:"城市标志性古塔" },
      "黄河铁桥":{ level:"4A", desc:"兰州中山桥，百年老桥" },
      "五泉山":{ level:"4A", desc:"泉潭叠落名胜" },
      "沙湖":{ level:"5A", desc:"芦苇与沙丘相映的湿地" },
      "西夏王陵":{ level:"5A", desc:"东方金字塔" },
      "青海湖":{ level:"5A", desc:"中国最大内陆湖" },
      "塔尔寺":{ level:"5A", desc:"格鲁派名寺" },
      "大召寺":{ level:"4A", desc:"呼市古寺，以银佛著称" },
      "昭君博物院":{ level:"4A", desc:"纪念王昭君和亲史事" },
      "古莲花池":{ level:"4A", desc:"古典园林风格，池馆相映" },
      "瘦西湖":{ level:"5A", desc:"二十四桥明月夜" },
      "中华恐龙园":{ level:"5A", desc:"恐龙主题乐园" },
      "狼山":{ level:"4A", desc:"南通名山" },
      "濠河":{ level:"5A", desc:"城中环形水系" },
      "刘公岛":{ level:"5A", desc:"甲午海战遗址与博物馆" },
      "蓬莱阁":{ level:"5A", desc:"八仙过海传说地" },
      "长岛":{ level:"4A", desc:"海岛风光，夏季避暑" },
      "乌镇":{ level:"5A", desc:"江南水乡，东西栅各具风味" },
      "雁荡山":{ level:"5A", desc:"奇峰怪石与瀑布群" },
      "楠溪江":{ level:"5A", desc:"清澈溪流与古村落" },
      "西湖(惠州)":{ level:"4A", desc:"城中湖景，步道休闲" },
      "双月湾":{ level:"4A", desc:"沙滩海湾拍照地" },
      "虎门大桥":{ level:"4A", desc:"跨珠江口重要通道" },
      "松山湖":{ level:"—", desc:"生态科技城，环湖绿道" },
      "祖庙":{ level:"5A", desc:"岭南古庙，木雕精美" },
      "顺德水乡":{ level:"—", desc:"美食与水乡并重" },
      "日月贝":{ level:"—", desc:"珠海歌剧院外形地标" },
      "情侣路":{ level:"—", desc:"海滨长廊，观港夜景" },
      "天山天池":{ level:"5A", desc:"雪山环抱的高山湖泊" },
      "亚龙湾":{ level:"5A", desc:"海水清澈沙细" },
      "天涯海角":{ level:"5A", desc:"岩石海景地标" },
      "骑楼老街":{ level:"4A", desc:"南洋风格骑楼街区" },
      "漓江":{ level:"5A", desc:"山水甲天下，竹筏漂流" },
      "阳朔":{ level:"4A", desc:"喀斯特群峰与乡村骑行" },
      "武陵源景区":{ level:"5A", desc:"砂岩峰林世界遗产" },
      "龙门石窟":{ level:"5A", desc:"佛教石刻艺术宝库" },
      "清明上河园":{ level:"4A", desc:"仿北宋市井风貌主题园" },
      "滕王阁":{ level:"5A", desc:"“落霞与孤鹜齐飞”名楼" },
      "钓鱼城遗址":{ level:"4A", desc:"古战场遗址，合川名片" },
      "老龙头":{ level:"5A", desc:"长城入海处" },
      "北戴河":{ level:"4A", desc:"海滨度假与观鸟" },
      "鲁迅故里":{ level:"5A", desc:"名人故里与古城街巷" },
      "东湖(绍兴)":{ level:"4A", desc:"水上石景别具一格" },
      "普陀山":{ level:"5A", desc:"海天佛国，四大佛教名山之一" },
      "七星岩":{ level:"5A", desc:"喀斯特石灰岩洞与湖景" },
      "孙中山故里":{ level:"4A", desc:"近现代史迹聚落" },
      "千山":{ level:"5A", desc:"奇峰怪石与寺庙分布" },
      "扎龙自然保护区":{ level:"5A", desc:"丹顶鹤保护地" },
      "油田科普园":{ level:"—", desc:"了解大庆油田发展史" }
    };

    // 经济型酒店大床房均价（¥/晚，经验值）
    const PRICE = {"北京":380,"上海":380,"广州":320,"深圳":340,"杭州":320,"成都":280,"重庆":260,"武汉":260,"西安":260,"苏州":300,"南京":300,"天津":260,"郑州":240,"长沙":260,"宁波":280,"厦门":320,"福州":260,"哈尔滨":220,"沈阳":220,"大连":260,"青岛":280,"济南":260,"合肥":240,"昆明":260,"贵阳":220,"南宁":220,"无锡":280,"长春":220,"石家庄":220,"太原":220,"兰州":220,"银川":200,"西宁":200,"呼和浩特":200,"保定":200,"扬州":220,"常州":260,"南通":240,"威海":240,"烟台":240,"嘉兴":240,"温州":240,"惠州":220,"东莞":260,"佛山":240,"珠海":260,"乌鲁木齐":240,"三亚":350,"海口":240,"桂林":240,"张家界":240,"洛阳":220,"开封":200,"南昌":240,"合川(重庆)":200,"秦皇岛":220,"绍兴":240,"舟山":260,"肇庆":200,"中山":220,"鞍山":200,"齐齐哈尔":180,"大庆":200};

    // 最佳旅行季节（经验建议）
    const SEASON = {"北京":"4-5月、9-10月","上海":"3-5月、10-11月","广州":"10-12月、3-4月","深圳":"10-12月、3-4月","杭州":"3-5月、10-11月","成都":"3-5月、9-11月","重庆":"10-3月（避暑热）","武汉":"3-5月、10-11月","西安":"4-5月、9-10月","苏州":"3-5月、9-11月","南京":"3-5月、9-11月","天津":"4-5月、9-10月","郑州":"4-5月、9-10月","长沙":"3-5月、10-11月","宁波":"3-5月、9-11月","厦门":"10-12月、3-4月","福州":"10-12月、3-4月","哈尔滨":"6-8月/12-2月","沈阳":"5-10月","大连":"6-9月","青岛":"6-9月","济南":"4-5月、9-10月","合肥":"3-5月、9-11月","昆明":"全年宜人（3-5月、9-11月最佳）","贵阳":"6-8月（避暑）","南宁":"10-12月、2-4月","无锡":"3-5月、9-11月","长春":"6-9月","石家庄":"4-5月、9-10月","太原":"5-10月","兰州":"5-10月","银川":"5-10月","西宁":"6-9月","呼和浩特":"5-9月","保定":"4-5月、9-10月","扬州":"3-5月、9-11月","常州":"3-5月、9-11月","南通":"3-5月、9-11月","威海":"6-9月","烟台":"6-9月","嘉兴":"3-5月、9-11月","温州":"3-5月、10-11月","惠州":"10-12月、3-4月","东莞":"10-12月、3-4月","佛山":"10-12月、3-4月","珠海":"10-12月、3-4月","乌鲁木齐":"6-9月","三亚":"11-3月","海口":"11-3月","桂林":"3-5月、9-11月","张家界":"4-6月、9-10月","洛阳":"4-5月、9-10月","开封":"4-5月、9-10月","南昌":"3-5月、10-11月","合川(重庆)":"10-3月","秦皇岛":"6-9月","绍兴":"3-5月、9-11月","舟山":"5-9月","肇庆":"10-12月、3-4月","中山":"10-12月、3-4月","鞍山":"5-9月","齐齐哈尔":"6-8月","大庆":"6-8月"};

    // 住宿推荐区域
    const AREAS = {
      "北京":["王府井/东华门","前门/天安门","三里屯/国贸"],
      "上海":["外滩/南京东路-人民广场","陆家嘴","新天地-淮海路"],
      "广州":["天河/珠江新城","北京路-越秀","上下九-荔湾"],
      "深圳":["福田会展中心","深圳湾/后海","罗湖口岸-东门"],
      "杭州":["西湖湖滨","武林广场","钱江新城"],
      "成都":["春熙路/太古里","宽窄巷子附近","高新区环球中心"],
      "重庆":["解放碑-洪崖洞","观音桥","南滨路"],
      "武汉":["江汉路步行街","楚河汉街","汉口火车站商圈"],
      "西安":["钟鼓楼/回民街","大雁塔/曲江","小寨商圈"],
      "苏州":["观前街/平江路","金鸡湖/园区","石路"],
      "南京":["新街口","夫子庙秦淮","玄武湖/鼓楼"],
      "天津":["滨江道-和平路","意式风情区","小白楼"],
      "郑州":["二七广场","郑东新区CBD","高铁东站"],
      "长沙":["五一广场/IFS","太平街/坡子街","橘子洲/岳麓"],
      "宁波":["天一广场","老外滩","东部新城"],
      "厦门":["中山路步行街","鼓浪屿码头附近","曾厝垵"],
      "福州":["三坊七巷/东街口","会展-万象城","火车站周边"],
      "哈尔滨":["中央大街/索菲亚","松北冰雪大世界","哈站商圈"],
      "沈阳":["太原街","中街/故宫","奥体-万象城"],
      "大连":["中山广场","青泥洼桥","星海广场"],
      "青岛":["五四广场/奥帆中心","中山路/栈桥","八大关"],
      "济南":["泉城路/趵突泉","大明湖","奥体中心"],
      "合肥":["政务区/万象城","三里庵","滨湖新区"],
      "昆明":["南屏街/正义坊","翠湖","官渡广场"],
      "贵阳":["喷水池/甲秀楼","观山湖区","会展中心"],
      "南宁":["朝阳广场","东盟商务区","青秀山周边"],
      "无锡":["南长街/南禅寺","太湖鼋头渚","苏宁广场"],
      "长春":["重庆路/桂林路","人民广场","净月潭"],
      "石家庄":["勒泰中心/北国","万象城","火车站商圈"],
      "太原":["迎泽大街/柳巷","长风街/万象城","太原南站"],
      "兰州":["正宁路夜市/中心","中山桥/黄河母亲","西站商圈"],
      "银川":["鼓楼老城","阅海湾/万象城","火车站周边"],
      "西宁":["莫家街/水井巷","海湖新区","火车站"],
      "呼和浩特":["中山西路","海亮广场","赛罕区万达"],
      "保定":["朝阳大街/万博","高新区","古莲花池周边"],
      "扬州":["瘦西湖东门","东关街","文昌阁/淮海路"],
      "常州":["恐龙园","吾悦广场","武进湖塘"],
      "南通":["崇川CBD","南大街","开发区"],
      "威海":["国际海水浴场","幸福门/九龙城","火车站周边"],
      "烟台":["滨海广场","芝罘区/南大街","火车站周边"],
      "嘉兴":["南湖","中山路商圈","高铁南站"],
      "温州":["五马街","鹿城区中心","瓯海万象城"],
      "惠州":["西湖/步行街","惠州南站","江北CBD"],
      "东莞":["东城万达/世博","厚街展馆","南城鸿福路"],
      "佛山":["祖庙/岭南天地","千灯湖/桂城","顺德大良"],
      "珠海":["情侣路/海滨泳场","拱北口岸","香洲老城"],
      "乌鲁木齐":["红山/友好商圈","中山路","高铁站片区"],
      "三亚":["三亚湾","大东海","亚龙湾"],
      "海口":["骑楼老街/解放西","万绿园/国贸","美兰站周边"],
      "桂林":["两江四湖/正阳步行街","象鼻山","阳朔西街(转住)"],
      "张家界":["武陵源景区门口","天门山索道站","市中心步行街"],
      "洛阳":["老城丽景门/洛邑古城","王城公园/国购","龙门高铁站"],
      "开封":["鼓楼/清明上河园周边","包公祠/大梁门","金明广场"],
      "南昌":["八一广场/中山路","红谷滩万达","滕王阁片区"],
      "合川(重庆)": ["合阳城/文峰古街","区府体育馆","涪江滨江"]
    };

    // —— 工具函数 ——
    function formatPop(n){ if(!n) return "—（待补充）"; const num = Number(n); return num.toLocaleString('zh-CN') + `（约${(num/10000).toFixed(1)}万人）`; }
    const popOf   = name => formatPop(POP2020[name]);
    const priceOf = name => PRICE[name] ? `约 ¥${PRICE[name]}/晚` : '—';
    const seasonOf= name => SEASON[name] || '10-11月（通用宜游）';
    const areasOf = name => (AREAS[name] || ['市中心/火车站周边','景区就近']).join('、');

    function cleanSpot(name){ return name.replace(/\(.*?\)|（.*?）/g, ""); }
    const BAIKE_NAME = { '少林寺(登封)': '少林寺', '故宫(沈阳)': '沈阳故宫', '西湖(惠州)': '惠州西湖', '东湖(绍兴)': '绍兴东湖' };
    function baikeLink(spot){ const key = BAIKE_NAME[spot] || cleanSpot(spot); return 'https://baike.baidu.com/item/' + encodeURIComponent(key); }

    // 说明：使用 Unsplash 关键词图片作为示意图；如加载失败，则回退为 SVG 占位图
    const IMG_QUERY = {
      '故宫':'Forbidden City Beijing','长城':'Great Wall China','外滩':'The Bund Shanghai','东方明珠':'Oriental Pearl Tower','广州塔':'Canton Tower','沙面':'Shamian Guangzhou','深圳湾':'Shenzhen Bay','公园群':'Shenzhen Park',
      '西湖':'West Lake Hangzhou','灵隐寺':'Lingyin Temple','大熊猫基地':'Chengdu Panda Base','锦里':'Jinli Street Chengdu','洪崖洞':'Hongya Cave Chongqing','解放碑':'Jiefangbei Chongqing',
      '黄鹤楼':'Yellow Crane Tower Wuhan','东湖':'East Lake Wuhan','兵马俑':'Terracotta Warriors','古城墙':'Xian City Wall','拙政园':'Humble Administrator s Garden','周庄':'Zhouzhuang Water Town',
      '中山陵':'Sun Yat-sen Mausoleum Nanjing','夫子庙':'Confucius Temple Nanjing','意式风情区':'Italian Style Town Tianjin','海河':'Haihe River Tianjin','少林寺':'Shaolin Temple','岳麓山':'Yuelu Mountain','橘子洲':'Orange Isle Changsha',
      '天一阁':'Tianyi Pavilion','老外滩':'Ningbo Laowaitan','鼓浪屿':'Gulangyu','三坊七巷':'Three Lanes and Seven Alleys Fuzhou','冰雪大世界':'Harbin Ice and Snow World','故宫(沈阳)':'Shenyang Imperial Palace',
      '星海广场':'Xinghai Square','滨海路':'Binhai Road Dalian','栈桥':'Zhanqiao Pier Qingdao','崂山':'Laoshan Qingdao','趵突泉':'Baotu Spring','千佛山':'Qianfo Mountain','三河古镇':'Sanhe Ancient Town',
      '滇池':'Dianchi Lake','石林':'Stone Forest Yunnan','甲秀楼':'Jiaxiu Tower','青岩古镇':'Qingyan Ancient Town','南湖公园':'Nanning Nanhu Park','青秀山':'Qingxiu Mountain','太湖':'Taihu Lake',
      '灵山大佛':'Lingshan Grand Buddha','净月潭':'Jingyue Lake','赵州桥':'Zhaozhou Bridge','抱犊寨':'Baodu Zhai','晋祠':'Jinci Temple','双塔寺':'Twin Pagodas Taiyuan','黄河铁桥':'Zhongshan Bridge Lanzhou',
      '五泉山':'Five Springs Park Lanzhou','沙湖':'Shahu Lake Ningxia','西夏王陵':'Western Xia Mausoleums','青海湖':'Qinghai Lake','塔尔寺':'Kumbum Monastery','大召寺':'Dazhao Temple Hohhot',
      '昭君博物院':'Wang Zhaojun Museum','古莲花池':'Ancient Lotus Pond Baoding','瘦西湖':'Slender West Lake','中华恐龙园':'China Dinosaur Park','狼山':'Langshan Nantong','濠河':'Hao River Nantong',
      '刘公岛':'Liugong Island','蓬莱阁':'Penglai Pavilion','长岛':'Changdao Islands','乌镇':'Wuzhen Water Town','雁荡山':'Yandang Mountain','楠溪江':'Nanxi River','西湖(惠州)':'Huizhou West Lake',
      '双月湾':'Double Moon Bay','虎门大桥':'Humen Bridge','松山湖':'Songshan Lake','祖庙':'Foshan Ancestral Temple','顺德水乡':'Shunde Water Town','日月贝':'Zhuhai Opera House','情侣路':'Qinglv Road Zhuhai',
      '天山天池':'Heavenly Lake Tianshan','亚龙湾':'Yalong Bay','天涯海角':'Tianya Haijiao','骑楼老街':'Qilou Old Street Haikou','漓江':'Li River Guilin','阳朔':'Yangshuo',
      '武陵源景区':'Wulingyuan','龙门石窟':'Longmen Grottoes','清明上河园':'Qingming Riverside Garden','滕王阁':'Tengwang Pavilion','钓鱼城遗址':'Diaoyu Fortress','老龙头':'Laolongtou Shanhaiguan',
      '北戴河':'Beidaihe','鲁迅故里':'Lu Xun Native Place','东湖(绍兴)':'Shaoxing Donghu','普陀山':'Mount Putuo','七星岩':'Seven Star Crags','孙中山故里':'Sun Yat-sen Hometown','千山':'Qianshan Anshan',
      '扎龙自然保护区':'Zhalong Nature Reserve','油田科普园':'Daqing Oil Field Museum'
    };
    function imgForSpot(n){ const key = IMG_QUERY[n] || (cleanSpot(n) + ' 中国 景点'); return 'https://source.unsplash.com/featured/?' + encodeURIComponent(key); }
    function placeholderSVG(n){ const svg = `<svg xmlns='http://www.w3.org/2000/svg' width='480' height='300'><defs><linearGradient id='g' x1='0' y1='0' x2='1' y2='1'><stop stop-color='#e5e7eb'/><stop offset='1' stop-color='#cbd5e1'/></linearGradient></defs><rect fill='url(#g)' width='100%' height='100%'/><text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' font-family='system-ui,Arial' font-size='28' fill='#334155'>${n}</text></svg>`; return 'data:image/svg+xml;utf8,' + encodeURIComponent(svg); }

    function spotCardsHTML(city){
      const names=(city.spot||'').split('、').map(s=>s.trim()).filter(Boolean);
      if(!names.length) return '<em>暂无</em>';
      return '<div class="spot-grid">'+names.map(n=>{
        const meta = SPOT_META[n] || {}; const lvl = meta.level || '—';
        const img=imgForSpot(n); const link=baikeLink(n); const ph=placeholderSVG(n);
        return `<figure class="spot-card"><img class=\"spot-img\" src=\"${img}\" alt=\"${n} 插图\" onerror=\"this.onerror=null;this.src='${ph}'\"><figcaption><span><b>${n}</b><span class=\"badge\">${lvl}</span></span><a class=\"baike\" href=\"${link}\" target=\"_blank\" rel=\"noopener\">百度百科</a></figcaption></figure>`;
      }).join('') + '</div>';
    }

    // —— DOM ——
    const KEY = "china-travel-favs-v1";
    const $current = document.getElementById('current');
    const $favs = document.getElementById('favorites');
    const $roll = document.getElementById('btn-roll');
    const $fav = document.getElementById('btn-fav');
    const $export = document.getElementById('btn-export');
    const $search = document.getElementById('search');
    const $picker = document.getElementById('picker');
    const $pickBtn = document.getElementById('btn-pick');
    const $clearBtn = document.getElementById('btn-clear');
    const $cityList = document.getElementById('city-list');

    let current = DATA[Math.floor(Math.random()*DATA.length)];
    let favorites = [];
    try { const raw = localStorage.getItem(KEY); if (raw) favorites = JSON.parse(raw); } catch {}
    function saveFavs(){ try{ localStorage.setItem(KEY, JSON.stringify(favorites)); }catch{} }

    function renderCurrent(){
      const isFav = favorites.some(f=>f.name===current.name);
      $fav.textContent = isFav ? '取消收藏' : '收藏';
      $current.innerHTML = `
        <div class="title">推荐城市：${current.name}</div>
        <div class="kvs">
          <div class="key">距离/航程</div><div>${current.distance}</div>
          <div class="key">人均GDP</div><div>${current.gdp}</div>
          <div class="key">著名景点</div><div>${current.spot}</div>
          <div class="key">10月平均气温</div><div>${current.temp.replace('10月：','')}</div>
          <div class="key">著名美食</div><div>${current.food}</div>
          <div class="key">人口（2020普查，全市常住人口）</div><div>${popOf(current.name)}</div>
          <div class="key">经济酒店均价</div><div>${priceOf(current.name)}</div>
          <div class="key">最佳旅行季节</div><div>${seasonOf(current.name)}</div>
          <div class="key">住宿推荐区域</div><div>${areasOf(current.name)}</div>
          <div class="key">省份/属性</div><div>${current.province}</div>
          <div class="key">地理位置</div><div>${current.location}</div>
        </div>
        <details class="spots"><summary>展开：景点图文与百科</summary>${spotCardsHTML(current)}</details>`;
    }

    function renderFavs(){
      const q = ($search.value||'').trim();
      const list = q? favorites.filter(f=>f.name.includes(q)) : favorites;
      if(!list.length){ $favs.innerHTML = '<div class="meta">暂无收藏或无搜索结果。</div>'; return; }
      $favs.innerHTML = list.map(c=>`
        <div class="fav">
          <div class="title">${c.name}</div>
          <div class="meta">${c.province}｜${c.location}</div>
          <div class="kvs">
            <div class="key">距离/航程</div><div>${c.distance}</div>
            <div class="key">人均GDP</div><div>${c.gdp}</div>
            <div class="key">10月</div><div>${c.temp.replace('10月：','')}</div>
            <div class="key">美食</div><div>${c.food}</div>
            <div class="key">人口</div><div>${popOf(c.name)}</div>
            <div class="key">均价</div><div>${priceOf(c.name)}</div>
            <div class="key">季节</div><div>${seasonOf(c.name)}</div>
            <div class="key">住宿</div><div>${areasOf(c.name)}</div>
            <div class="key">景点</div><div>${c.spot}</div>
          </div>
          <details class="spots"><summary>景点图文与百科</summary>${spotCardsHTML(c)}</details>
          <div class="row" style="margin-top:8px">
            <button data-remove="${c.name}">删除</button>
          </div>
        </div>
      `).join('');
      $favs.querySelectorAll('button[data-remove]').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          const name = btn.getAttribute('data-remove');
          favorites = favorites.filter(f=>f.name!==name);
          saveFavs();
          renderFavs();
          renderCurrent();
        });
      });
    }

    // 选择城市 & datalist
    function selectCityByName(name){ if(!name) return; const exact = DATA.find(c => c.name === name.trim()); const fuzzy = exact || DATA.find(c => c.name.includes(name.trim())); if(fuzzy){ current = fuzzy; renderCurrent(); } else { alert('未找到该城市，请检查输入（例如：北京、上海、成都）'); } }
    (function fillDatalist(){ if(!$cityList) return; $cityList.innerHTML = DATA.map(c => `<option value="${c.name}"></option>`).join(''); })();

    // 事件
    $roll.addEventListener('click', ()=>{ current = DATA[Math.floor(Math.random()*DATA.length)]; renderCurrent(); });
    $fav.addEventListener('click', ()=>{ const idx = favorites.findIndex(f=>f.name===current.name); if(idx>=0) favorites.splice(idx,1); else favorites.unshift(current); favorites = favorites.slice(0, 200); saveFavs(); renderCurrent(); renderFavs(); });
    $search.addEventListener('input', renderFavs);
    $picker.addEventListener('keydown', (e) => { if(e.key === 'Enter'){ selectCityByName($picker.value); } });
    $pickBtn.addEventListener('click', () => selectCityByName($picker.value));
    $clearBtn.addEventListener('click', () => { $picker.value = ''; $picker.focus(); });

    // CSV 导出（尽量兼容：不使用 replaceAll）
    function csvEscape(v){ return '"' + String(v).replace(/"/g,'""') + '"'; }
    $export.addEventListener('click', ()=>{
      if(!favorites.length){ alert('没有可导出的收藏。'); return; }
      const header = ['城市','省份/属性','地理位置','距离/航程','人均GDP','10月平均气温','著名美食','人口（2020普查）','经济酒店均价(¥/晚)','最佳旅行季节','住宿推荐区域','著名景点','景点评级(合并)','百科链接(合并)'];
      const rows = favorites.map(c=>{
        const names=(c.spot||'').split('、').map(s=>s.trim()).filter(Boolean);
        const levels=names.map(n=> (SPOT_META[n]&&SPOT_META[n].level)||'').filter(Boolean).join(' | ');
        const links =names.map(n=> baikeLink(n)).join(' | ');
        return [c.name,c.province,c.location,c.distance,c.gdp,c.temp.replace('10月：',''),c.food,popOf(c.name),PRICE[c.name]||'',seasonOf(c.name),areasOf(c.name),c.spot,levels,links];
      });
      const csv = [header.map(csvEscape).join(','), ...rows.map(r=>r.map(csvEscape).join(','))].join('\n');
      const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = '收藏城市_扩展信息.csv'; a.click(); URL.revokeObjectURL(url);
    });

    // 初始渲染
    renderCurrent();
    renderFavs();
  </script>
</body>
</html>
