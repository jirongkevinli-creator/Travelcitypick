<!doctype html>
<html lang="zh">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>中国旅游推荐（从延吉出发）</title>
  <style>
    :root { --bg:#fafbff; --card:#ffffff; --ink:#0f172a; --muted:#64748b; --line:#e5e7eb; --accent:#2563eb; }
    *{ box-sizing:border-box }
    body{ margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, Noto Sans, "Apple Color Emoji","Segoe UI Emoji"; background:var(--bg); color:var(--ink); }
    .wrap{ max-width:1000px; margin:0 auto; padding:24px; }
    header{ display:flex; flex-wrap:wrap; align-items:flex-end; justify-content:space-between; gap:12px; }
    h1{ margin:0; font-size:clamp(22px, 3vw, 28px); }
    p.lead{ color:var(--muted); margin:6px 0 0; }
    .card{ background:var(--card); border:1px solid var(--line); border-radius:16px; padding:16px; box-shadow:0 1px 2px rgba(0,0,0,.04); }
    .row{ display:flex; flex-wrap:wrap; gap:8px; align-items:center; }
    .row > *{ margin:4px 0; }
    button{ appearance:none; border:1px solid var(--line); background:#fff; color:var(--ink); padding:10px 14px; border-radius:12px; cursor:pointer; font-weight:600; }
    button.primary{ background:var(--accent); color:#fff; border-color:var(--accent); }
    button.ghost{ background:transparent; }
    button:disabled{ opacity:.6; cursor:not-allowed; }
    input{ width:100%; max-width:360px; padding:10px 12px; border:1px solid var(--line); border-radius:10px; }
    .grid{ display:grid; grid-template-columns:repeat(auto-fill, minmax(260px,1fr)); gap:12px; }
    .fav{ border:1px dashed var(--line); border-radius:12px; padding:12px; }
    .meta{ color:var(--muted); font-size:14px; }
    .kvs{ margin:8px 0 0; display:grid; grid-template-columns: 140px 1fr; gap:6px 10px; font-size:14px; }
    .kvs div{ padding:2px 0; }
    .kvs .key{ color:var(--muted); }
    .title{ font-weight:700; font-size:18px; }
    .spacer{ height:8px; }
    footer{ color:var(--muted); font-size:13px; margin-top:18px; }
  </style>
</head>
<body>
  <noscript>浏览器未启用 JavaScript，此页面功能无法使用。</noscript>
  <div class="wrap">
    <header>
      <div>
        <h1>中国旅游推荐（从延吉出发）</h1>
        <p class="lead">随机推荐 50 个主要城市之一，显示中文旅行要点。*数据为近似示意*</p>
      </div>
      <div class="row">
        <button id="btn-roll" class="primary">再推荐</button>
        <button id="btn-fav">收藏</button>
        <button id="btn-export" class="ghost">导出收藏</button>
      </div>
    </header>

    <div class="spacer"></div>

    <!-- 快速查找城市（推荐卡片上方） -->
    <div class="row card" style="gap:10px; align-items:center;">
      <input id="picker" list="city-list" placeholder="快速查找城市（输入城市名，如：北京、上海、成都）" style="flex:1; max-width:520px;" />
      <datalist id="city-list"></datalist>
      <button id="btn-pick" class="primary">选择城市</button>
      <button id="btn-clear" class="ghost">清空</button>
    </div>

    <div class="spacer"></div>

    <section id="current" class="card" aria-live="polite"></section>

    <div class="spacer"></div>

    <div class="row">
      <input id="search" placeholder="搜索收藏 (例: 北京、上海)" />
    </div>

    <h3>收藏</h3>
    <section id="favorites" class="grid" aria-live="polite"></section>

    <footer>提示：人口口径为 2020 年第七次全国人口普查“全市常住人口”。其他指标为概况值；收藏仅保存在浏览器本地。</footer>
  </div>

  <!-- ✅ 把所有 JS 放在 <script> 里，不要粘到 HTML 外面，否则会像文本一样显示在页面上 -->
  <script>
    // —— 2020年七普 常住人口（单位：人）——
    const POP2020 = {
      "北京": 21893095, "上海": 24870895, "广州": 18676605, "深圳": 17560061, "杭州": 11936010,
      "成都": 20937757, "重庆": 32054159, "武汉": 12326500, "西安": 12952907, "苏州": 12748262,
      "南京": 9314685,  "天津": 13866009, "郑州": 12600574, "长沙": 10047914, "宁波": 9404283,
      "厦门": 5163970,  "福州": 8291268,  "哈尔滨": 10009854, "沈阳": 9070093,  "大连": 7450785,
      "青岛": 10071595, "济南": 9202432,  "合肥": 9369881,  "昆明": 8460088,  "贵阳": 5987018,
      "南宁": 8741584,  "无锡": 7462135,  "长春": 9066517,  "石家庄": 11235086, "太原": 5303592,
      "兰州": 4359446,  "银川": 2854616,  "西宁": 2467837,  "呼和浩特": 3445007, "保定": 11437217,
      "扬州": 4559797,  "常州": 5278121,  "南通": 7726635,  "威海": 2906548,  "烟台": 7132193,
      "嘉兴": 5400868,  "温州": 9572903,  "惠州": 6042852,  "东莞": 10466729, "佛山": 9498863,
      "珠海": 2439585,  "乌鲁木齐": 4054369, "三亚": 1031396,  "海口": 2873358,  "桂林": 4931137,
      "张家界": 1526956, "洛阳": 6571799,  "开封": 4368830,  "南昌": 6256364,  "合川(重庆)": 1532598,
      "秦皇岛": 3146330, "绍兴": 5058648,  "舟山": 1179945,  "肇庆": 4121478,  "中山": 4420291,
      "鞍山": 3320793,  "齐齐哈尔": 4921204, "大庆": 2863840
    };

    function formatPop(n){ if(!n) return "—（待补充）"; const num = +n; return num.toLocaleString('zh-CN') + `（约${(num/10000).toFixed(1)}万人）`; }
    function popOf(name){ return formatPop(POP2020[name]); }

    // —— 样例 DATA（与您之前的一致，人口字段会被 popOf(name) 覆盖显示）——
    const DATA = [
      { name: "北京", distance: "约 1,500 公里 / 飞行 2 小时", gdp: "人均GDP：约 ¥180,000", spot: "故宫、长城", temp: "10月：12℃", food: "北京烤鸭", population: "", province: "直辖市·北京", location: "华北地区" },
      { name: "上海", distance: "约 1,800 公里 / 飞行 2.5 小时", gdp: "人均GDP：约 ¥190,000", spot: "外滩、东方明珠", temp: "10月：19℃", food: "生煎、小笼包", population: "", province: "直辖市·上海", location: "华东沿海" },
      { name: "广州", distance: "约 2,800 公里 / 飞行 3.5 小时", gdp: "人均GDP：约 ¥170,000", spot: "广州塔、沙面", temp: "10月：26℃", food: "早茶、烧鹅", population: "", province: "广东省", location: "华南沿海" }
      // ……其余城市省略（请使用你现有的完整列表）
    ];

    const KEY = "china-travel-favs-v1";
    const $current = document.getElementById('current');
    const $favs = document.getElementById('favorites');
    const $roll = document.getElementById('btn-roll');
    const $fav = document.getElementById('btn-fav');
    const $export = document.getElementById('btn-export');
    const $search = document.getElementById('search');
    const $picker = document.getElementById('picker');
    const $pickBtn = document.getElementById('btn-pick');
    const $clearBtn = document.getElementById('btn-clear');
    const $cityList = document.getElementById('city-list');

    let current = DATA[Math.floor(Math.random()*DATA.length)];
    let favorites = [];

    try { const raw = localStorage.getItem(KEY); if (raw) favorites = JSON.parse(raw); } catch {}
    function saveFavs(){ try{ localStorage.setItem(KEY, JSON.stringify(favorites)); }catch{} }

    function renderCurrent(){
      const isFav = favorites.some(f=>f.name===current.name);
      $fav.textContent = isFav ? '取消收藏' : '收藏';
      const popText = popOf(current.name);
      $current.innerHTML = `
        <div class="title">推荐城市：${current.name}</div>
        <div class="kvs">
          <div class="key">距离/航程</div><div>${current.distance}</div>
          <div class="key">人均GDP</div><div>${current.gdp}</div>
          <div class="key">著名景点</div><div>${current.spot}</div>
          <div class="key">10月平均气温</div><div>${current.temp.replace('10月：','')}</div>
          <div class="key">著名美食</div><div>${current.food}</div>
          <div class="key">人口（2020普查，全市常住人口）</div><div>${popText}</div>
          <div class="key">省份/属性</div><div>${current.province}</div>
          <div class="key">地理位置</div><div>${current.location}</div>
        </div>`;
    }

    function renderFavs(){
      const q = ($search.value||'').trim();
      const list = q? favorites.filter(f=>f.name.includes(q)) : favorites;
      if(!list.length){ $favs.innerHTML = '<div class="meta">暂无收藏或无搜索结果。</div>'; return; }
      $favs.innerHTML = list.map(c=>{
        const popText = popOf(c.name);
        return `
        <div class="fav">
          <div class="title">${c.name}</div>
          <div class="meta">${c.province}｜${c.location}</div>
          <div class="kvs">
            <div class="key">距离/航程</div><div>${c.distance}</div>
            <div class="key">人均GDP</div><div>${c.gdp}</div>
            <div class="key">10月</div><div>${c.temp.replace('10月：','')}</div>
            <div class="key">美食</div><div>${c.food}</div>
            <div class="key">人口（2020普查，全市常住人口）</div><div>${popText}</div>
            <div class="key">景点</div><div>${c.spot}</div>
          </div>
          <div class="row" style="margin-top:8px">
            <button data-remove="${c.name}">删除</button>
          </div>
        </div>`;
      }).join('');
      $favs.querySelectorAll('button[data-remove]').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          const name = btn.getAttribute('data-remove');
          favorites = favorites.filter(f=>f.name!==name);
          saveFavs();
          renderFavs();
          renderCurrent();
        });
      });
    }

    function selectCityByName(name){
      if(!name) return;
      const exact = DATA.find(c => c.name === name.trim());
      const fuzzy = exact || DATA.find(c => c.name.includes(name.trim()));
      if(fuzzy){ current = fuzzy; renderCurrent(); }
      else { alert('未找到该城市，请检查输入（例如：北京、上海、成都）'); }
    }

    (function fillDatalist(){ if(!$cityList) return; $cityList.innerHTML = DATA.map(c => `<option value="${c.name}"></option>`).join(''); })();

    $roll.addEventListener('click', ()=>{ current = DATA[Math.floor(Math.random()*DATA.length)]; renderCurrent(); });
    $fav.addEventListener('click', ()=>{
      const idx = favorites.findIndex(f=>f.name===current.name);
      if(idx>=0) favorites.splice(idx,1); else favorites.unshift(current);
      favorites = favorites.slice(0, 200);
      saveFavs();
      renderCurrent();
      renderFavs();
    });
    $search.addEventListener('input', renderFavs);

    $picker.addEventListener('keydown', (e) => { if(e.key === 'Enter'){ selectCityByName($picker.value); } });
    $pickBtn.addEventListener('click', () => selectCityByName($picker.value));
    $clearBtn.addEventListener('click', () => { $picker.value = ''; $picker.focus(); });

    $export.addEventListener('click', ()=>{
      if(!favorites.length){ alert('没有可导出的收藏。'); return; }
      const header = ['城市','省份/属性','地理位置','距离/航程','人均GDP','10月平均气温','著名美食','人口（2020普查，全市常住人口）','著名景点'];
      const rows = favorites.map(c=>[
        c.name, c.province, c.location, c.distance, c.gdp, c.temp.replace('10月：',''), c.food, popOf(c.name), c.spot
      ]);
      const csv = [header.join(','), ...rows.map(r=>r.map(v=>`"${String(v).replaceAll('"','""')}"`).join(','))].join('\n');
      const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = '收藏城市.csv'; a.click();
      URL.revokeObjectURL(url);
    });

    // 初始渲染
    renderCurrent();
    renderFavs();
  </script>
</body>
</html>
